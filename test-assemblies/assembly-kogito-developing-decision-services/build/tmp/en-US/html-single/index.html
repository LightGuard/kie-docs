<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="chrometwo"><head><title>Developing decision services with Kogito</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css"/><meta name="generator" content="publican v4.3.4"/><meta name="description" content="This document describes how to create and run a basic business application that uses Kogito services."/><link rel="next" href="#idm139794257891824" title="Preface"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><script type="text/javascript" src="Common_Content/scripts/jquery-1.7.1.min.js"> </script><script type="text/javascript" src="Common_Content/scripts/utils.js"> </script><script type="text/javascript" src="Common_Content/scripts/highlight.js/highlight.pack.js"> </script></head><body><div id="chrometwo"><div id="main"><div xml:lang="en-US" class="book" id="idm139794255678448"><div class="titlepage"><div><div class="producttitle"><span class="productname">Kogito</span> <span class="productnumber">0.9</span></div><div><h1 class="title">Developing decision services with Kogito</h1></div><div><h2 class="subtitle"/></div><div><a href="#idm139794259275536">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				This document describes how to create and run a basic business application that uses Kogito services.
			</div></div></div></div><hr/></div><div class="toc"><ul class="toc"><li><span class="preface"><a href="#idm139794257891824">Preface</a></span></li><li><span class="chapter"><a href="#ref-decision-authoring-assets_kogito-developing-decision-services">1. Decision-authoring assets in Kogito</a></span></li><li><span class="chapter"><a href="#ref-kogito-app-examples_kogito-developing-decision-services">2. Example applications with Kogito services</a></span></li><li><span class="part"><a href="#chap-kogito-using-dmn-models">I. Using DMN models in Kogito services</a></span><ul><li><span class="chapter"><a href="#con-dmn_dmn-models">3. Decision Model and Notation (DMN)</a></span><ul><li><span class="section"><a href="#con-dmn-conformance-levels_dmn-models">3.1. DMN conformance levels</a></span></li><li><span class="section"><a href="#ref-dmn-drd-components-ref-dmn-models">3.2. DMN decision requirements diagram (DRD) components</a></span></li></ul></li><li><span class="chapter"><a href="#proc-dmn-model-creating_dmn-models">4. Creating and editing DMN models in the Kogito DMN modeler</a></span></li><li><span class="chapter"><a href="#con-kogito-service-execution_dmn-models">5. Kogito service execution</a></span></li></ul></li><li><span class="part"><a href="#chap-kogito-using-drl-rules">II. Using DRL rules in Kogito services</a></span><ul><li><span class="chapter"><a href="#con-drl_drl-rules">6. Drools Rule Language (DRL)</a></span></li><li><span class="chapter"><a href="#con-drl-packages_drl-rules">7. Packages in DRL</a></span></li><li><span class="chapter"><a href="#con-drl-imports_drl-rules">8. Import statements in DRL</a></span></li><li><span class="chapter"><a href="#con-drl-rule-units_drl-rules">9. Rule units in DRL</a></span><ul><li><span class="section"><a href="#rule_unit_use_case">9.1. Rule unit use case</a></span></li><li><span class="section"><a href="#data_sources_for_drl_rule_units">9.2. Data sources for DRL rule units</a></span></li><li><span class="section"><a href="#drl_rule_unit_declaration_using_java">9.3. DRL rule unit declaration using Java</a></span></li><li><span class="section"><a href="#drl_rule_units_with_bpmn_processes">9.4. DRL rule units with BPMN processes</a></span></li></ul></li><li><span class="chapter"><a href="#con-drl-rules-conditions_drl-rules">10. Rule conditions in DRL</a></span><ul><li><span class="section"><a href="#oopath_expressions_and_constraints">10.1. OOPath expressions and constraints</a></span></li><li><span class="section"><a href="#bound_variables_in_patterns_and_constraints">10.2. Bound variables in patterns and constraints</a></span></li><li><span class="section"><a href="#nested_constraints_and_inline_casts">10.3. Nested constraints and inline casts</a></span></li><li><span class="section"><a href="#date_literal_in_constraints">10.4. Date literal in constraints</a></span></li></ul></li><li><span class="chapter"><a href="#con-drl-rules-actions_drl-rules">11. Rule actions in DRL</a></span></li><li><span class="chapter"><a href="#con-property-change-listeners_drl-rules">12. Property-change settings and listeners for fact types</a></span></li><li><span class="chapter"><a href="#proc-drl-rules-central-create_drl-rules">13. Creating DRL rules for your Kogito project</a></span></li><li><span class="chapter"><a href="#con-kogito-service-execution_drl-rules">14. Kogito service execution</a></span></li></ul></li><li><span class="part"><a href="#chap-kogito-using-spreadsheet-decision-tables">III. Using spreadsheet decision tables in Kogito services</a></span><ul><li><span class="chapter"><a href="#con-decision-tables_decision-tables">15. Spreadsheet decision tables</a></span></li><li><span class="chapter"><a href="#con-decision-tables-use-case_decision-tables">16. Decision table use case</a></span></li><li><span class="chapter"><a href="#proc-decision-tables-creating_decision-tables">17. Creating spreadsheet decision tables for your Kogito project</a></span><ul><li><span class="section"><a href="#ref-decision-tables-rule-set-entries_decision-tables">17.1. RuleSet definitions</a></span></li><li><span class="section"><a href="#ref-decision-tables-rule-table-entries_decision-tables">17.2. RuleTable definitions</a></span></li><li><span class="section"><a href="#ref-decision-tables-attributes_decision-tables">17.3. Additional rule attributes for RuleSet or RuleTable definitions</a></span></li></ul></li><li><span class="chapter"><a href="#con-kogito-service-execution_decision-tables">18. Kogito service execution</a></span></li></ul></li><li><span class="part"><a href="#chap-kogito-decision-engine">IV. Decision engine in Kogito</a></span><ul><li><span class="chapter"><a href="#con-decision-engine_decision-engine">19. Decision engine in Kogito</a></span></li><li><span class="chapter"><a href="#con-execution-control_decision-engine">20. Execution control in the decision engine</a></span><ul><li><span class="section"><a href="#salience_for_rules">20.1. Salience for rules</a></span></li><li><span class="section"><a href="#activation_groups_for_rules">20.2. Activation groups for rules</a></span></li></ul></li><li><span class="chapter"><a href="#con-phreak-rule-evaluation_decision-engine">21. Rule evaluation in Phreak</a></span><ul><li><span class="section"><a href="#con-forward-and-backward-chaining_decision-engine">21.1. Rule evaluation with forward and backward chaining</a></span></li></ul></li><li><span class="chapter"><a href="#con-property-change-listeners_decision-engine">22. Property-change settings and listeners for fact types</a></span></li><li><span class="chapter"><a href="#con-engine-event-listeners_decision-engine">23. Decision engine event listeners and debug logging</a></span></li></ul></li><li><span class="appendix"><a href="#versioning-information">A. Versioning information</a></span></li></ul></div><section class="preface" id="idm139794257891824"><div class="titlepage"><div><div><h1 class="title">Preface</h1></div></div></div><p>
			As a developer of business decisions, you can use Kogito business automation to develop decision services using Decision Model and Notation (DMN) models, Drools Rule Language (DRL) rules, XLS or XLSX spreadsheet decision tables, or a combination of all three methods.
		</p></section><section class="chapter" id="ref-decision-authoring-assets_kogito-developing-decision-services"><div class="titlepage"><div><div><h1 class="title">Chapter 1. Decision-authoring assets in Kogito</h1></div></div></div><p>
			Kogito supports several assets that you can use to define business decisions for your decision service. Each decision-authoring asset has different advantages, and you might prefer to use one or a combination of multiple assets depending on your goals and needs.
		</p><p>
			The following table highlights the main decision-authoring assets supported in Kogito projects to help you decide or confirm the best method for defining decisions in your decision service.
		</p><div class="table" id="idm139794252658224"><p class="title"><strong>Table 1.1. Decision-authoring assets supported in Kogito</strong></p><div class="table-contents"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 20%; " class="col_1"/><col style="width: 40%; " class="col_2"/><col style="width: 20%; " class="col_3"/><col style="width: 20%; " class="col_4"/></colgroup><thead><tr><th align="left" valign="top" id="idm139794251169248" scope="col">Asset</th><th align="left" valign="top" id="idm139794251168160" scope="col">Highlights</th><th align="left" valign="top" id="idm139794251167072" scope="col">Authoring tools</th><th align="left" valign="top" id="idm139794251165984" scope="col">Documentation</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139794251169248">
						<p>
							Decision Model and Notation (DMN) models
						</p>
						</td><td align="left" valign="top" headers="idm139794251168160">
						<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Are decision models based on a notation standard defined by the Object Management Group (OMG)
								</li><li class="listitem">
									Use graphical decision requirements diagrams (DRDs) with one or more decision requirements graphs (DRGs) to trace business decision flows
								</li><li class="listitem">
									Use an XML schema that allows the DMN models to be shared between DMN-compliant platforms
								</li><li class="listitem">
									Support Friendly Enough Expression Language (FEEL) to define decision logic in DMN decision tables and other DMN boxed expressions
								</li><li class="listitem">
									Can be integrated efficiently with Business Process Model and Notation (BPMN) process models
								</li><li class="listitem">
									Are optimal for creating comprehensive, illustrative, and stable decision flows
								</li></ul></div>
						</td><td align="left" valign="top" headers="idm139794251167072">
						<p>
							Kogito DMN modeler in VSCode or other DMN-compliant editor
						</p>
						</td><td align="left" valign="top" headers="idm139794251165984">
						<p>
							<a class="xref" href="#con-dmn_dmn-models" title="Chapter 3. Decision Model and Notation (DMN)">Chapter 3, <em>Decision Model and Notation (DMN)</em></a>
						</p>
						</td></tr><tr><td align="left" valign="top" headers="idm139794251169248">
						<p>
							DRL rules
						</p>
						</td><td align="left" valign="top" headers="idm139794251168160">
						<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Are individual rules that you define directly in <code class="literal">.drl</code> text files
								</li><li class="listitem">
									Provide the most flexibility for defining rules and other technicalities of rule behavior
								</li><li class="listitem">
									Are optimal for creating rules that require advanced DRL options, such as rule units
								</li><li class="listitem">
									Have strict syntax requirements for rules to be compiled properly
								</li></ul></div>
						</td><td align="left" valign="top" headers="idm139794251167072">
						<p>
							Any integrated development environment (IDE)
						</p>
						</td><td align="left" valign="top" headers="idm139794251165984">
						<p>
							<a class="xref" href="#con-drl_drl-rules" title="Chapter 6. Drools Rule Language (DRL)">Chapter 6, <em>Drools Rule Language (DRL)</em></a>
						</p>
						</td></tr><tr><td align="left" valign="top" headers="idm139794251169248">
						<p>
							Spreadsheet decision tables
						</p>
						</td><td align="left" valign="top" headers="idm139794251168160">
						<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Are tabular sets of rules that you define in <code class="literal">.xls</code> or <code class="literal">.xlsx</code> spreadsheet files
								</li><li class="listitem">
									Support template keys and values for creating rule templates
								</li><li class="listitem">
									Are optimal for business environments that already rely on decision tables for rules
								</li><li class="listitem">
									Have strict syntax requirements for rules to be compiled properly when used in Kogito
								</li></ul></div>
						</td><td align="left" valign="top" headers="idm139794251167072">
						<p>
							Spreadsheet editor
						</p>
						</td><td align="left" valign="top" headers="idm139794251165984">
						<p>
							<a class="xref" href="#con-decision-tables_decision-tables" title="Chapter 15. Spreadsheet decision tables">Chapter 15, <em>Spreadsheet decision tables</em></a>
						</p>
						</td></tr></tbody></table></div></div></section><section class="chapter" id="ref-kogito-app-examples_kogito-developing-decision-services"><div class="titlepage"><div><div><h1 class="title">Chapter 2. Example applications with Kogito services</h1></div></div></div><p>
			Kogito includes example applications in the <a class="link" href="https://github.com/kiegroup/kogito-examples"><code class="literal">kogito-examples</code></a> repository in GitHub. These example applications contain various types of Kogito services on Quarkus or Spring Boot to help you develop your own applications. The services use one or more Business Process Model and Notation (BPMN) process models, Decision Model and Notation (DMN) decision models, Drools Rule Language (DRL) rule units, XLS spreadsheet decision tables, or Java classes to define the service logic.
		</p><p>
			For information about each example application and instructions for using them, see the <code class="literal">README</code> file in the relevant application folder.
		</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				In the <a class="link" href="https://github.com/kiegroup/kogito-examples"><code class="literal">kogito-examples</code></a> repository in GitHub, the example applications in the default <code class="literal">stable</code> branch use the latest version of Kogito.
			</p></div></div><p>
			The following list describes some of the examples provided with Kogito:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					<code class="literal">dmn-quarkus-example</code> and <code class="literal">dmn-springboot-example</code>: A decision service (on Quarkus or Spring Boot) that uses DMN to determine driver penalty and suspension based on traffic violations
				</li><li class="listitem">
					<code class="literal">rules-quarkus-helloworld</code>: A Hello World decision service on Quarkus with a single DRL rule unit
				</li><li class="listitem">
					<code class="literal">ruleunit-quarkus-example</code> and <code class="literal">ruleunit-springboot-example</code>: A decision service (on Quarkus or Spring Boot) that uses DRL with rule units to validate a loan application and that exposes REST operations to view application status
				</li><li class="listitem">
					<code class="literal">process-quarkus-helloworld</code>: A Hello World process service on Quarkus with a single BPMN model
				</li><li class="listitem">
					<code class="literal">process-quarkus-example</code> and <code class="literal">process-springboot-example</code>: A process service (on Quarkus or Spring Boot) for ordering items and that exposes REST operations to create new orders or to list and delete active orders
				</li><li class="listitem">
					<code class="literal">onboarding-example</code>: A combination of a process service and two decision services that use DMN and DRL for onboarding new employees
				</li><li class="listitem">
					<code class="literal">kogito-travel-agency</code>: A combination of process services and decision services that use DRL and XLS for travel booking, intended for deployment on Red Hat OpenShift Container Platform
				</li></ul></div></section><div class="part" id="chap-kogito-using-dmn-models"><div class="titlepage"><div><div><h1 class="title">Part I. Using DMN models in Kogito services</h1></div></div></div><div class="partintro" id="idm139794259113760"><div/><p>
				As a developer of business decisions, you can use Decision Model and Notation (DMN) to model a decision service graphically in a decision requirements diagram (DRD). This diagram consists of one or more decision requirements graphs (DRGs) that trace business decisions from start to finish, with each decision node using logic defined in DMN boxed expressions such as decision tables.
			</p><p>
				Kogito provides design and runtime support for DMN 1.2 models at conformance level 3, and runtime-only support for DMN 1.1 and 1.3 models at conformance level 3. You can design your DMN models with the Kogito DMN modeler in VSCode or import existing DMN models into your Kogito projects for deployment and execution. Any DMN 1.1 models that you import into your Kogito project, open in the DMN modeler, and save are converted to DMN 1.2 models. DMN 1.3 models are not supported in the Kogito DMN modeler.
			</p><p>
				For more information about DMN, see the Object Management Group (OMG) <a class="link" href="https://www.omg.org/spec/DMN">Decision Model and Notation specification</a>.
			</p><div class="toc"><p><strong>Table of Contents</strong></p><ul class="toc"><li><span class="chapter"><a href="#con-dmn_dmn-models">3. Decision Model and Notation (DMN)</a></span><ul><li><span class="section"><a href="#con-dmn-conformance-levels_dmn-models">3.1. DMN conformance levels</a></span></li><li><span class="section"><a href="#ref-dmn-drd-components-ref-dmn-models">3.2. DMN decision requirements diagram (DRD) components</a></span></li></ul></li><li><span class="chapter"><a href="#proc-dmn-model-creating_dmn-models">4. Creating and editing DMN models in the Kogito DMN modeler</a></span></li><li><span class="chapter"><a href="#con-kogito-service-execution_dmn-models">5. Kogito service execution</a></span></li></ul></div></div><section class="chapter" id="con-dmn_dmn-models"><div class="titlepage"><div><div><h2 class="title">Chapter 3. Decision Model and Notation (DMN)</h2></div></div></div><p>
				Decision Model and Notation (DMN) is a standard established by the <a class="link" href="https://www.omg.org/">Object Management Group (OMG)</a> for describing and modeling operational decisions. DMN defines an XML schema that enables DMN models to be shared between DMN-compliant platforms and across organizations so that business analysts and business rules developers can collaborate in designing and implementing DMN decision services. The DMN standard is similar to and can be used together with the Business Process Model and Notation (BPMN) standard for designing and modeling business processes.
			</p><p>
				For more information about the background and applications of DMN, see the OMG <a class="link" href="https://www.omg.org/spec/DMN">Decision Model and Notation specification</a>.
			</p><section class="section" id="con-dmn-conformance-levels_dmn-models"><div class="titlepage"><div><div><h2 class="title">3.1. DMN conformance levels</h2></div></div></div><p>
					The DMN specification defines three incremental levels of conformance in a software implementation. A product that claims compliance at one level must also be compliant with any preceding levels. For example, a conformance level 3 implementation must also include the supported components in conformance levels 1 and 2. For the formal definitions of each conformance level, see the OMG <a class="link" href="https://www.omg.org/spec/DMN">Decision Model and Notation specification</a>.
				</p><p>
					The following list summarizes the three DMN conformance levels:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Conformance level 1</span></dt><dd>
								A DMN conformance level 1 implementation supports decision requirement diagrams (DRDs), decision logic, and decision tables, but decision models are not executable. Any language can be used to define the expressions, including natural, unstructured languages.
							</dd><dt><span class="term">Conformance level 2</span></dt><dd>
								A DMN conformance level 2 implementation includes the requirements in conformance level 1, and supports Simplified Friendly Enough Expression Language (S-FEEL) expressions and fully executable decision models.
							</dd><dt><span class="term">Conformance level 3</span></dt><dd>
								A DMN conformance level 3 implementation includes the requirements in conformance levels 1 and 2, and supports Friendly Enough Expression Language (FEEL) expressions, the full set of boxed expressions, and fully executable decision models.
							</dd></dl></div><p>
					Kogito provides design and runtime support for DMN 1.2 models at conformance level 3, and runtime-only support for DMN 1.1 and 1.3 models at conformance level 3. You can design your DMN models with the Kogito DMN modeler in VSCode or import existing DMN models into your Kogito projects for deployment and execution. Any DMN 1.1 models that you import into your Kogito project, open in the DMN modeler, and save are converted to DMN 1.2 models. DMN 1.3 models are not supported in the Kogito DMN modeler.
				</p></section><section class="section" id="ref-dmn-drd-components-ref-dmn-models"><div class="titlepage"><div><div><h2 class="title">3.2. DMN decision requirements diagram (DRD) components</h2></div></div></div><p>
					A decision requirements diagram (DRD) is a visual representation of your DMN model. This diagram consists of one or more decision requirements graphs (DRGs) that represent a particular domain of an overall DRD. The DRGs trace business decisions using decision nodes, business knowledge models, sources of business knowledge, input data, and decision services.
				</p><p>
					The following table summarizes the components in a DRD:
				</p><div class="table" id="idm139794257488960"><p class="title"><strong>Table 3.1. DRD components</strong></p><div class="table-contents"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 20%; " class="col_1"/><col style="width: 20%; " class="col_2"/><col style="width: 40%; " class="col_3"/><col style="width: 20%; " class="col_4"/></colgroup><thead><tr><th colspan="2" align="left" valign="top" id="idm139794249654192" scope="col">Component</th><th align="left" valign="top" id="idm139794249652496" scope="col">Description</th><th align="left" valign="top" id="idm139794249651408" scope="col">Notation</th></tr></thead><tbody><tr><td rowspan="5" align="left" valign="top" headers="idm139794249654192">
								<p>
									Elements
								</p>
								</td><td align="left" valign="top" headers="idm139794249654192">
								<p>
									Decision
								</p>
								</td><td align="left" valign="top" headers="idm139794249652496">
								<p>
									Node where one or more input elements determine an output based on defined decision logic.
								</p>
								</td><td align="left" valign="top" headers="idm139794249651408"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-decision-node.png" alt="dmn decision node"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794249654192">
								<p>
									Business knowledge model
								</p>
								</td><td align="left" valign="top" headers="idm139794249652496">
								<p>
									Reusable function with one or more decision elements. Decisions that have the same logic but depend on different sub-input data or sub-decisions use business knowledge models to determine which procedure to follow.
								</p>
								</td><td align="left" valign="top" headers="idm139794249651408"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-bkm-node.png" alt="dmn bkm node"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794249654192">
								<p>
									Knowledge source
								</p>
								</td><td align="left" valign="top" headers="idm139794249652496">
								<p>
									External authorities, documents, committees, or policies that regulate a decision or business knowledge model. Knowledge sources are references to real-world factors rather than executable business rules.
								</p>
								</td><td align="left" valign="top" headers="idm139794249651408"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-knowledge-source-node.png" alt="dmn knowledge source node"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794249654192">
								<p>
									Input data
								</p>
								</td><td align="left" valign="top" headers="idm139794249652496">
								<p>
									Information used in a decision node or a business knowledge model. Input data usually includes business-level concepts or objects relevant to the business, such as loan applicant data used in a lending strategy.
								</p>
								</td><td align="left" valign="top" headers="idm139794249651408"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-input-data-node.png" alt="dmn input data node"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794249654192">
								<p>
									Decision service
								</p>
								</td><td align="left" valign="top" headers="idm139794249652496">
								<p>
									Top-level decision containing a set of reusable decisions published as a service for invocation. A decision service can be invoked from an external application or a BPMN business process.
								</p>
								</td><td align="left" valign="top" headers="idm139794249651408"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-decision-service-node.png" alt="dmn decision service node"/></div></div></td></tr><tr><td rowspan="3" align="left" valign="top" headers="idm139794249654192">
								<p>
									Requirement connectors
								</p>
								</td><td align="left" valign="top" headers="idm139794249654192">
								<p>
									Information requirement
								</p>
								</td><td align="left" valign="top" headers="idm139794249652496">
								<p>
									Connection from an input data node or decision node to another decision node that requires the information.
								</p>
								</td><td align="left" valign="top" headers="idm139794249651408"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-info-connector.png" alt="dmn info connector"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794249654192">
								<p>
									Knowledge requirement
								</p>
								</td><td align="left" valign="top" headers="idm139794249652496">
								<p>
									Connection from a business knowledge model to a decision node or to another business knowledge model that invokes the decision logic.
								</p>
								</td><td align="left" valign="top" headers="idm139794249651408"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-knowledge-connector.png" alt="dmn knowledge connector"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794249654192">
								<p>
									Authority requirement
								</p>
								</td><td align="left" valign="top" headers="idm139794249652496">
								<p>
									Connection from an input data node or a decision node to a dependent knowledge source or from a knowledge source to a decision node, business knowledge model, or another knowledge source.
								</p>
								</td><td align="left" valign="top" headers="idm139794249651408"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-authority-connector.png" alt="dmn authority connector"/></div></div></td></tr><tr><td rowspan="2" align="left" valign="top" headers="idm139794249654192">
								<p>
									Artifacts
								</p>
								</td><td align="left" valign="top" headers="idm139794249654192">
								<p>
									Text annotation
								</p>
								</td><td align="left" valign="top" headers="idm139794249652496">
								<p>
									Explanatory note associated with an input data node, decision node, business knowledge model, or knowledge source.
								</p>
								</td><td align="left" valign="top" headers="idm139794249651408"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-annotation-node.png" alt="dmn annotation node"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794249654192">
								<p>
									Association
								</p>
								</td><td align="left" valign="top" headers="idm139794249652496">
								<p>
									Connection from an input data node, decision node, business knowledge model, or knowledge source to a text annotation.
								</p>
								</td><td align="left" valign="top" headers="idm139794249651408"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-association-connector.png" alt="dmn association connector"/></div></div></td></tr></tbody></table></div></div><p>
					The following table summarizes the permitted connectors between DRD elements:
				</p><div class="table" id="idm139794255248496"><p class="title"><strong>Table 3.2. DRD connector rules</strong></p><div class="table-contents"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 20%; " class="col_1"/><col style="width: 20%; " class="col_2"/><col style="width: 20%; " class="col_3"/><col style="width: 40%; " class="col_4"/></colgroup><thead><tr><th align="left" valign="top" id="idm139794255241808" scope="col">Starts from</th><th align="left" valign="top" id="idm139794255240720" scope="col">Connects to</th><th align="left" valign="top" id="idm139794256414720" scope="col">Connection type</th><th align="left" valign="top" id="idm139794256413632" scope="col">Example</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139794255241808">
								<p>
									Decision
								</p>
								</td><td align="left" valign="top" headers="idm139794255240720">
								<p>
									Decision
								</p>
								</td><td align="left" valign="top" headers="idm139794256414720">
								<p>
									Information requirement
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-decision-to-decision.png" alt="dmn decision to decision"/></div></div></td></tr><tr><td rowspan="2" align="left" valign="top" headers="idm139794255241808">
								<p>
									Business knowledge model
								</p>
								</td><td align="left" valign="top" headers="idm139794255240720">
								<p>
									Decision
								</p>
								</td><td rowspan="2" align="left" valign="top" headers="idm139794256414720">
								<p>
									Knowledge requirement
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-bkm-to-decision.png" alt="dmn bkm to decision"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794255240720">
								<p>
									Business knowledge model
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-bkm-to-bkm.png" alt="dmn bkm to bkm"/></div></div></td></tr><tr><td rowspan="2" align="left" valign="top" headers="idm139794255241808">
								<p>
									Decision service
								</p>
								</td><td align="left" valign="top" headers="idm139794255240720">
								<p>
									Decision
								</p>
								</td><td rowspan="2" align="left" valign="top" headers="idm139794256414720">
								<p>
									Knowledge requirement
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-decision-service-to-decision.png" alt="dmn decision service to decision"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794255240720">
								<p>
									Business knowledge model
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-decision-service-to-bkm.png" alt="dmn decision service to bkm"/></div></div></td></tr><tr><td rowspan="2" align="left" valign="top" headers="idm139794255241808">
								<p>
									Input data
								</p>
								</td><td align="left" valign="top" headers="idm139794255240720">
								<p>
									Decision
								</p>
								</td><td align="left" valign="top" headers="idm139794256414720">
								<p>
									Information requirement
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-input-to-decision.png" alt="dmn input to decision"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794255240720">
								<p>
									Knowledge source
								</p>
								</td><td align="left" valign="top" headers="idm139794256414720">
								<p>
									Authority requirement
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-input-to-knowledge-source.png" alt="dmn input to knowledge source"/></div></div></td></tr><tr><td rowspan="3" align="left" valign="top" headers="idm139794255241808">
								<p>
									Knowledge source
								</p>
								</td><td align="left" valign="top" headers="idm139794255240720">
								<p>
									Decision
								</p>
								</td><td rowspan="3" align="left" valign="top" headers="idm139794256414720">
								<p>
									Authority requirement
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-knowledge-source-to-decision.png" alt="dmn knowledge source to decision"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794255240720">
								<p>
									Business knowledge model
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-knowledge-source-to-bkm.png" alt="dmn knowledge source to bkm"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794255240720">
								<p>
									Knowledge source
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-knowledge-source-to-knowledge-source.png" alt="dmn knowledge source to knowledge source"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794255241808">
								<p>
									Decision
								</p>
								</td><td rowspan="4" align="left" valign="top" headers="idm139794255240720">
								<p>
									Text annotation
								</p>
								</td><td rowspan="4" align="left" valign="top" headers="idm139794256414720">
								<p>
									Association
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-decision-to-annotation.png" alt="dmn decision to annotation"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794255241808">
								<p>
									Business knowledge model
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-bkm-to-annotation.png" alt="dmn bkm to annotation"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794255241808">
								<p>
									Knowledge source
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-knowledge-source-to-annotation.png" alt="dmn knowledge source to annotation"/></div></div></td></tr><tr><td align="left" valign="top" headers="idm139794255241808">
								<p>
									Input data
								</p>
								</td><td align="left" valign="top" headers="idm139794256413632"><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-input-to-annotation.png" alt="dmn input to annotation"/></div></div></td></tr></tbody></table></div></div><p>
					The following example DRD illustrates some of these DMN components in practice:
				</p><div class="figure" id="idm139794249698416"><p class="title"><strong>Figure 3.1. Example DRD: Loan prequalification</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-example-drd.png" alt="dmn example drd"/></div></div></div><p>
					The following example DRD illustrates DMN components that are part of a reusable decision service:
				</p><div class="figure" id="idm139794249694048"><p class="title"><strong>Figure 3.2. Example DRD: Phone call handling as a decision service</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-example-drd3.png" width="486" alt="dmn example drd3"/></div></div></div><p>
					In a DMN decision service node, the decision nodes in the bottom segment incorporate input data from outside of the decision service to arrive at a final decision in the top segment of the decision service node. The resulting top-level decisions from the decision service are then implemented in any subsequent decisions or business knowledge requirements of the DMN model. You can reuse DMN decision services in other DMN models to apply the same decision logic with different input data and different outgoing connections.
				</p></section></section><section class="chapter" id="proc-dmn-model-creating_dmn-models"><div class="titlepage"><div><div><h2 class="title">Chapter 4. Creating and editing DMN models in the Kogito DMN modeler</h2></div></div></div><p>
				You can use the Kogito DMN modeler in VSCode to design DMN decision requirements diagrams (DRDs) and define decision logic for a complete and functional DMN decision model. Kogito provides design and runtime support for DMN 1.2 models at conformance level 3, and includes enhancements and fixes to FEEL and DMN model components to optimize the experience of implementing DMN decision services with Kogito. Kogito also provides runtime-only support for DMN 1.1 and 1.3 models at conformance level 3, but any DMN 1.1 models that you import into your Kogito project, open in the DMN modeler, and save are converted to DMN 1.2 models. DMN 1.3 models are not supported in the Kogito DMN modeler.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="https://code.visualstudio.com/">VSCode</a> 1.43.0 or later is installed.
					</li><li class="listitem">
						The Kogito <a class="link" href="https://github.com/kiegroup/kogito-tooling/releases">VSCode extension</a> is installed and enabled in your VSCode IDE. For information about enabling the VSCode extension, see <a class="link" href="https://access.redhat.com/documentation/en-us/kogito/0.9/html-single/creating_and_running_your_first_kogito_services#proc-kogito-vscode-extension_kogito-creating-running"><span class="emphasis"><em>Creating and running your first Kogito services</em></span></a>.
					</li><li class="listitem">
						You have created a Kogito project and have included any Java objects required for your Kogito service. For information about creating a project, see <a class="link" href="https://access.redhat.com/documentation/en-us/kogito/0.9/html-single/creating_and_running_your_first_kogito_services"><span class="emphasis"><em>Creating and running your first Kogito services</em></span></a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In your VSCode IDE, create or import a DMN file in the relevant folder of your Kogito project, typically in <code class="literal">src/main/resources</code>.
					</li><li class="listitem"><p class="simpara">
						Open the new or imported DMN file to view the decision requirements diagram (DRD) in the Kogito DMN modeler.
					</p><p class="simpara">
						If the DRD does not open in the Kogito DMN modeler, ensure that you have installed and enabled the Kogito <a class="link" href="https://github.com/kiegroup/kogito-tooling/releases">VSCode extension</a>.
					</p><p class="simpara">
						If the Kogito DMN modeler opens only the XML source of the DMN file and displays an error message, review the reported errors and the DMN model file to ensure that all DMN elements are correctly defined.
					</p></li><li class="listitem"><p class="simpara">
						Begin adding components to your new or imported DRD by clicking and dragging one of the DMN nodes from the left toolbar:
					</p><div class="figure" id="idm139794257632496"><p class="title"><strong>Figure 4.1. Adding DRD components</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-drag-decision-node.png" alt="dmn drag decision node"/></div></div></div><p class="simpara">
						The following DRD components are available:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>Decision</strong></span>: Use this node for a DMN decision, where one or more input elements determine an output based on defined decision logic.
							</li><li class="listitem">
								<span class="strong strong"><strong>Business knowledge model</strong></span>: Use this node for reusable functions with one or more decision elements. Decisions that have the same logic but depend on different sub-input data or sub-decisions use business knowledge models to determine which procedure to follow.
							</li><li class="listitem">
								<span class="strong strong"><strong>Knowledge source</strong></span>: Use this node for external authorities, documents, committees, or policies that regulate a decision or business knowledge model. Knowledge sources are references to real-world factors rather than executable business rules.
							</li><li class="listitem">
								<span class="strong strong"><strong>Input data</strong></span>: Use this node for information used in a decision node or a business knowledge model. Input data usually includes business-level concepts or objects relevant to the business, such as loan applicant data used in a lending strategy.
							</li><li class="listitem">
								<span class="strong strong"><strong>Text annotation</strong></span>: Use this node for explanatory notes associated with an input data node, decision node, business knowledge model, or knowledge source.
							</li><li class="listitem">
								<span class="strong strong"><strong>Decision service</strong></span>: Use this node to enclose a set of reusable decisions implemented as a decision service for invocation. A decision service can be used in other DMN models and can be invoked from an external application or a BPMN business process.
							</li></ul></div></li><li class="listitem">
						In the DMN modeler canvas, double-click the new DRD node to enter an informative node name.
					</li><li class="listitem"><p class="simpara">
						If the node is a decision or business knowledge model, select the node to display the node options and click the <span class="strong strong"><strong>Edit</strong></span> icon to open the DMN boxed expression editor to define the decision logic for the node:
					</p><div class="figure" id="idm139794257548704"><p class="title"><strong>Figure 4.2. Opening a new decision node boxed expression</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-decision-edit.png" alt="dmn decision edit"/></div></div></div><div class="figure" id="idm139794257544960"><p class="title"><strong>Figure 4.3. Opening a new business knowledge model boxed expression</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-bkm-edit.png" alt="dmn bkm edit"/></div></div></div><p class="simpara">
						By default, all business knowledge models are defined as boxed function expressions containing a literal FEEL expression, a nested context expression of an external JAVA or PMML function, or a nested boxed expression of any type.
					</p><p class="simpara">
						For decision nodes, you click the undefined table to select the type of boxed expression you want to use, such as a boxed literal expression, boxed context expression, decision table, or other DMN boxed expression.
					</p><div class="figure" id="idm139794251855904"><p class="title"><strong>Figure 4.4. Selecting the logic type for a decision node</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-decision-boxed-expression-options.png" alt="dmn decision boxed expression options"/></div></div></div><p class="simpara">
						For business knowledge models, you click the top-left function cell to select the function type, or right-click the function value cell, select <span class="strong strong"><strong>Clear</strong></span>, and select a boxed expression of another type.
					</p><div class="figure" id="idm139794251850784"><p class="title"><strong>Figure 4.5. Selecting the function or other logic type for a business knowledge model</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-bkm-define.png" alt="dmn bkm define"/></div></div></div></li><li class="listitem"><p class="simpara">
						In the selected boxed expression editor for either a decision node (any expression type) or business knowledge model (function expression), click the applicable table cells to define the table name, variable data types, variable names and values, function parameters and bindings, or FEEL expressions to include in the decision logic.
					</p><p class="simpara">
						You can right-click cells for additional actions where applicable, such as inserting or removing table rows and columns or clearing table contents.
					</p><p class="simpara">
						The following is an example decision table for a decision node that determines credit score ratings based on a defined range of a loan applicant’s credit score:
					</p><div class="figure" id="idm139794257730992"><p class="title"><strong>Figure 4.6. Decision node decision table for credit score rating</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-decision-table-example1a.png" alt="dmn decision table example1a"/></div></div></div><p class="simpara">
						The following is an example boxed function expression for a business knowledge model that calculates mortgage payments based on principal, interest, taxes, and insurance (PITI) as a literal expression:
					</p><div class="figure" id="idm139794257726560"><p class="title"><strong>Figure 4.7. Business knowledge model function for PITI calculation</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-function-expression-example4.png" alt="dmn function expression example4"/></div></div></div></li><li class="listitem">
						After you define the decision logic for the selected node, click <span class="strong strong"><strong>Back to <span class="emphasis"><em>MODEL_NAME</em></span></strong></span> to return to the DRD view.
					</li><li class="listitem"><p class="simpara">
						For the selected DRD node, use the available connection options to create and connect to the next node in the DRD, or click and drag a new node onto the DRD canvas from the left toolbar.
					</p><p class="simpara">
						The node type determines which connection options are supported. For example, an <span class="strong strong"><strong>Input data</strong></span> node can connect to a decision node, knowledge source, or text annotation using the applicable connection type, whereas a <span class="strong strong"><strong>Knowledge source</strong></span> node can connect to any DRD element. A <span class="strong strong"><strong>Decision</strong></span> node can connect only to another decision or a text annotation.
					</p><p class="simpara">
						The following connection types are available, depending on the node type:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>Information requirement</strong></span>: Use this connection from an input data node or decision node to another decision node that requires the information.
							</li><li class="listitem">
								<span class="strong strong"><strong>Knowledge requirement</strong></span>: Use this connection from a business knowledge model to a decision node or to another business knowledge model that invokes the decision logic.
							</li><li class="listitem">
								<span class="strong strong"><strong>Authority requirement</strong></span>: Use this connection from an input data node or a decision node to a dependent knowledge source or from a knowledge source to a decision node, business knowledge model, or another knowledge source.
							</li><li class="listitem">
								<span class="strong strong"><strong>Association</strong></span>: Use this connection from an input data node, decision node, business knowledge model, or knowledge source to a text annotation.
							</li></ul></div><div class="figure" id="idm139794253961520"><p class="title"><strong>Figure 4.8. Connecting credit score input to the credit score rating decision</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-input-connection-example.png" alt="dmn input connection example"/></div></div></div><div class="informalfigure"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-input-connection-example2.png" alt="dmn input connection example2"/></div></div></li><li class="listitem"><p class="simpara">
						Continue adding and defining the remaining DRD components of your decision model and save the completed DRD.
					</p><p class="simpara">
						The following is an example DRD for a loan prequalification decision model:
					</p><div class="figure" id="idm139794253952816"><p class="title"><strong>Figure 4.9. Completed DRD for loan prequalification</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-example-drd.png" alt="dmn example drd"/></div></div></div><p class="simpara">
						The following is an example DRD for a phone call handling decision model using a reusable decision service:
					</p><div class="figure" id="idm139794253973072"><p class="title"><strong>Figure 4.10. Completed DRD for phone call handling with a decision service</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/dmn/dmn-example-drd3.png" width="486" alt="dmn example drd3"/></div></div></div><p class="simpara">
						In a DMN decision service node, the decision nodes in the bottom segment incorporate input data from outside of the decision service to arrive at a final decision in the top segment of the decision service node. The resulting top-level decisions from the decision service are then implemented in any subsequent decisions or business knowledge requirements of the DMN model. You can reuse DMN decision services in other DMN models to apply the same decision logic with different input data and different outgoing connections.
					</p></li></ol></div></section><section class="chapter" id="con-kogito-service-execution_dmn-models"><div class="titlepage"><div><div><h2 class="title">Chapter 5. Kogito service execution</h2></div></div></div><p>
				After you design your Kogito service, you can build and run your application and then send REST API requests to the application to execute your services. The exact REST API requests that you can use depend on how you set up the application.
			</p><p>
				For example, consider a Kogito service that is set up to generate a <code class="literal">/persons</code> REST API endpoint and determines whether a specified customer is an adult or is underage. In this example, you can send the following <code class="literal">POST</code> request using a REST client or curl utility to add an adult and execute the service:
			</p><div class="formalpara"><p class="title"><strong>Example POST request body to add an adult (JSON)</strong></p><p>
					
<pre class="programlisting language-json">{
  "person": {
    "name": "John Quark",
    "age": 20
  }
}</pre>
				</p></div><div class="formalpara"><p class="title"><strong>Example curl command to add an adult</strong></p><p>
					
<pre class="screen">curl -X POST http://localhost:8080/persons -H 'content-type: application/json' -H 'accept: application/json' -d '{"person": {"name":"John Quark", "age": 20}}'</pre>
				</p></div><div class="formalpara"><p class="title"><strong>Example response (JSON)</strong></p><p>
					
<pre class="programlisting language-json">{
  "id": "3af806dd-8819-4734-a934-728f4c819682",
  "person": {
    "name": "John Quark",
    "age": 20,
    "adult": false
  },
  "isAdult": true
}</pre>
				</p></div><p>
				For information about creating, running, and testing an example application with Kogito services, see
			</p><p>
				For information about deploying your Kogito service to Red Hat OpenShift Container Platform, see
			</p></section></div><div class="part" id="chap-kogito-using-drl-rules"><div class="titlepage"><div><div><h1 class="title">Part II. Using DRL rules in Kogito services</h1></div></div></div><div class="partintro" id="idm139794249494096"><div/><p>
				As a developer of business decisions, you can define business rules using Drools Rule Language (DRL) directly in free-form <code class="literal">.drl</code> text files. A DRL file can contain one or more rules that define at a minimum the rule conditions (<code class="literal">when</code>) and actions (<code class="literal">then</code>).
			</p><div class="toc"><p><strong>Table of Contents</strong></p><ul class="toc"><li><span class="chapter"><a href="#con-drl_drl-rules">6. Drools Rule Language (DRL)</a></span></li><li><span class="chapter"><a href="#con-drl-packages_drl-rules">7. Packages in DRL</a></span></li><li><span class="chapter"><a href="#con-drl-imports_drl-rules">8. Import statements in DRL</a></span></li><li><span class="chapter"><a href="#con-drl-rule-units_drl-rules">9. Rule units in DRL</a></span><ul><li><span class="section"><a href="#rule_unit_use_case">9.1. Rule unit use case</a></span></li><li><span class="section"><a href="#data_sources_for_drl_rule_units">9.2. Data sources for DRL rule units</a></span></li><li><span class="section"><a href="#drl_rule_unit_declaration_using_java">9.3. DRL rule unit declaration using Java</a></span></li><li><span class="section"><a href="#drl_rule_units_with_bpmn_processes">9.4. DRL rule units with BPMN processes</a></span></li></ul></li><li><span class="chapter"><a href="#con-drl-rules-conditions_drl-rules">10. Rule conditions in DRL</a></span><ul><li><span class="section"><a href="#oopath_expressions_and_constraints">10.1. OOPath expressions and constraints</a></span></li><li><span class="section"><a href="#bound_variables_in_patterns_and_constraints">10.2. Bound variables in patterns and constraints</a></span></li><li><span class="section"><a href="#nested_constraints_and_inline_casts">10.3. Nested constraints and inline casts</a></span></li><li><span class="section"><a href="#date_literal_in_constraints">10.4. Date literal in constraints</a></span></li></ul></li><li><span class="chapter"><a href="#con-drl-rules-actions_drl-rules">11. Rule actions in DRL</a></span></li><li><span class="chapter"><a href="#con-property-change-listeners_drl-rules">12. Property-change settings and listeners for fact types</a></span></li><li><span class="chapter"><a href="#proc-drl-rules-central-create_drl-rules">13. Creating DRL rules for your Kogito project</a></span></li><li><span class="chapter"><a href="#con-kogito-service-execution_drl-rules">14. Kogito service execution</a></span></li></ul></div></div><section class="chapter" id="con-drl_drl-rules"><div class="titlepage"><div><div><h2 class="title">Chapter 6. Drools Rule Language (DRL)</h2></div></div></div><p>
				Drools Rule Language (DRL) is a notation established by the <a class="link" href="https://www.drools.org/">Drools</a> open source business automation project for defining and describing business rules. You define DRL rules in <code class="literal">.drl</code> text files. A DRL file can contain one or more rules that define at a minimum the rule conditions (<code class="literal">when</code>) and actions (<code class="literal">then</code>).
			</p><p>
				DRL files consist of the following components:
			</p><div class="formalpara"><p class="title"><strong>Components in a DRL file</strong></p><p>
					
<pre class="screen">package
unit

import

declare   // Optional

query  // Optional

rule "rule name"
    // Attributes
    when
        // Conditions
    then
        // Actions
end

rule "rule2 name"

...</pre>
				</p></div><p>
				The following example DRL rule determines the age limit in a loan application decision service:
			</p><div class="formalpara"><p class="title"><strong>Example rule for loan application age limit</strong></p><p>
					
<pre class="screen">rule "Underage"
  when
    /applicant[ applicantName : name, age &lt; 21 ]
    $application : /loanApplication[ applicant == applicantName ]
  then
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
end</pre>
				</p></div><p>
				A DRL file can contain single or multiple rules and queries, and can define resource declarations and attributes that are assigned and used by your rules and queries. The components in a DRL file are grouped in a defined rule unit that serves as a unique namespace for each group of rules. The DRL package followed by the rule unit definition must be listed at the top of a DRL file, and the rules are typically listed last. All other DRL components can follow any order.
			</p><p>
				Each rule must have a unique name within the rule unit. If you use the same rule name more than once in any DRL file in the unit, the rules fail to compile. Rule names generally must follow standard Java identifier conventions. However, you can enclose rule names with double quotation marks (<code class="literal">rule "rule name"</code>) to prevent possible compilation errors, especially if you use spaces in rule names.
			</p></section><section class="chapter" id="con-drl-packages_drl-rules"><div class="titlepage"><div><div><h2 class="title">Chapter 7. Packages in DRL</h2></div></div></div><p>
				A package is a folder of related assets in Kogito, such as data objects, DRL files, decision tables, and other asset types. A package also serves as a unique namespace for each group of rules. A single rule base can contain multiple packages. You typically store all the rules for a package in the same file as the package declaration so that the package is self-contained. However, you can import objects from other packages that you want to use in the rules.
			</p><p>
				The following example is a package name and namespace for a DRL file in a mortgage application decision service:
			</p><div class="formalpara"><p class="title"><strong>Example package definition in a DRL file</strong></p><p>
					
<pre class="screen">package org.mortgages;</pre>
				</p></div></section><section class="chapter" id="con-drl-imports_drl-rules"><div class="titlepage"><div><div><h2 class="title">Chapter 8. Import statements in DRL</h2></div></div></div><p>
				Similar to import statements in Java, imports in DRL files identify the fully qualified paths and type names for any objects that you want to use in the rules. You specify the package and data object in the format <code class="literal">packageName.objectName</code>, with multiple imports on separate lines. The decision engine automatically imports classes from the Java package with the same name as the DRL package and from the package <code class="literal">java.lang</code>.
			</p><p>
				The following example is an import statement for a loan application object in a mortgage application decision service:
			</p><div class="formalpara"><p class="title"><strong>Example import statement in a DRL file</strong></p><p>
					
<pre class="screen">import org.mortgages.LoanApplication;</pre>
				</p></div></section><section class="chapter" id="con-drl-rule-units_drl-rules"><div class="titlepage"><div><div><h2 class="title">Chapter 9. Rule units in DRL</h2></div></div></div><p>
				A DRL rule unit is a module for rules and a unit of execution. A rule unit collects a set of rules with the declaration of the type of facts that the rules act on. A rule unit also serves as a unique namespace for each group of rules. A single rule base can contain multiple rule units. You typically store all the rules for a unit in the same file as the unit declaration so that the unit is self-contained.
			</p><p>
				The following example is a rule unit designated in a DRL file in a mortgage application decision service:
			</p><div class="formalpara"><p class="title"><strong>Example package definition and rule unit designation in a DRL file</strong></p><p>
					
<pre class="screen">package org.mortgages;
unit MortgageRules;</pre>
				</p></div><p>
				To define a rule unit, you declare the relevant fact types and declare the data sources for the types by implementing the <code class="literal">RuleUnitData</code> interface, and then define the rules in the unit:
			</p><div class="formalpara"><p class="title"><strong>Example DRL rule unit file</strong></p><p>
					
<pre class="screen">package org.mortgages;
unit MortgageRules;

import org.kie.kogito.rules.DataSource;
import org.kie.kogito.rules.DataStream;

declare Person
    name : String
    dateOfBirth : Date
    address : Address
end

declare MortgageRules extends RuleUnitData
  person: DataStream&lt;Person&gt; = DataSource.createStream()
end

rule "Using a rule unit with a declared type"
  when
    $p : /person[ name == "James" ]
  then   // Insert Mark, who is a customer of James.
    Person mark = new Person();
    mark.setName( "Mark" );
    person.append( mark );
end</pre>
				</p></div><p>
				To separate the fact types from the rule unit for use with other DRL rules, you can declare the types in a separate DRL file and then use the DRL rule file to declare the data sources by using the <code class="literal">RuleUnitData</code> interface implementation:
			</p><div class="formalpara"><p class="title"><strong>Example DRL type declaration as a separate file</strong></p><p>
					
<pre class="screen">package org.mortgages;

declare Person
    name : String
    dateOfBirth : Date
    address : Address
end</pre>
				</p></div><div class="formalpara"><p class="title"><strong>Example DRL rule unit file without explicitly defined types</strong></p><p>
					
<pre class="screen">package org.mortgages;
unit MortgageRules;

import org.kie.kogito.rules.DataSource;
import org.kie.kogito.rules.DataStream;

declare MortgageRules extends RuleUnitData
  person: DataStream&lt;Person&gt; = DataSource.createStream()
end

rule "Using a rule unit with a declared type"
  when
    $p : /person[ name == "James" ]
  then   // Insert Mark, who is a customer of James.
    Person mark = new Person();
    mark.setName( "Mark" );
    person.append( mark );
end</pre>
				</p></div><p>
				In this example, <code class="literal">persons</code> is a <code class="literal">DataStream</code> data source for facts of type <code class="literal">Person</code>. Data sources are typed sources of data that rule units can subscribe to for updates. You interact with the rule unit through the data sources it exposes. A data source can be a <code class="literal">DataStream</code> source for append-only storage, a <code class="literal">DataStore</code> source for writable storage to add or remove data, or a <code class="literal">SingletonStore</code> source for writable storage to set and clear a single element.
			</p><p>
				As part of your data source declaration, you also import <code class="literal">org.kie.kogito.rules.DataSource</code> and the relevant data source support, such as <code class="literal">import org.kie.kogito.rules.DataStream</code> in this example.
			</p><p>
				You can add several rules to the same DRL file, or further break down the rule set and type declarations by creating more files. However you construct your rule sets, ensure that all DRL rule files exist in the same directory and start with the correct <code class="literal">package</code> and <code class="literal">unit</code> declarations.
			</p><section class="section" id="rule_unit_use_case"><div class="titlepage"><div><div><h2 class="title">9.1. Rule unit use case</h2></div></div></div><p>
					As an additional rule unit use case, consider the following example decision service that evaluates incoming data from a heat sensor for temperature measurements and produces alerts when the temperature is above a specified threshold.
				</p><p>
					This example service uses the following <code class="literal">types.drl</code> file in the <code class="literal">src/main/resources/org/acme</code> folder of the Kogito project to declare the <code class="literal">Temperature</code> and the <code class="literal">Alert</code> fact types:
				</p><div class="formalpara"><p class="title"><strong>Example DRL type declarations</strong></p><p>
						
<pre class="screen">package com.acme;

declare Temperature
  value: double
end

declare Alert
    severity: String
    message: String
end</pre>
					</p></div><p>
					To define DRL rules that pattern-match against <code class="literal">Temperature</code> values, the example service must expose an entry point for the incoming data to the decision engine and publish alerts on a separate channel. To establish this data source for decision data, the example service uses a rule unit with <code class="literal">DataStream</code> data sources for <code class="literal">Temperature</code> objects and for <code class="literal">Alert</code> objects.
				</p><p>
					The <code class="literal">DataStream</code> data source is an append-only store for incoming data, similar to a queue. This type of data source is logical for both sources in this example because the temperature data is coming from an external source (the sensor) and the service publishes the alerts externally as they are produced.
				</p><p>
					The example service uses the following <code class="literal">MonitoringService.drl</code> file in the same <code class="literal">src/main/resources/com/acme</code> folder of the Kogito project to declare the data sources for the fact types and defines the rules for the rule unit:
				</p><div class="formalpara"><p class="title"><strong>Example DRL rule unit file</strong></p><p>
						
<pre class="screen">package com.acme;
unit MonitoringService;

import org.kie.kogito.rules.DataSource;
import org.kie.kogito.rules.DataStream;

declare MonitoringService extends RuleUnitData
  temperature: DataStream&lt;Temperature&gt; = DataSource.createStream()
  alertData: DataStream&lt;Alert&gt; = DataSource.createStream()
end

rule "tooHot"
when
    $temp : /temperature[value &gt;= 80]
then
    alertData.append(new Alert("HIGH", "Temperature exceeds threshold: " + temp.value));
end</pre>
					</p></div><p>
					The rule unit implements the required <code class="literal">RuleUnitData</code> interface and declares the data sources for the previously defined types. The sample rule raises an alert when the temperature reaches or exceeds 80 degrees.
				</p></section><section class="section" id="data_sources_for_drl_rule_units"><div class="titlepage"><div><div><h2 class="title">9.2. Data sources for DRL rule units</h2></div></div></div><p>
					Data sources are typed sources of data that rule units can subscribe to for updates. You interact with the rule unit through the data sources it exposes.
				</p><p>
					Kogito supports the following types of data sources. When you declare data sources in DRL rule files, the sources are internally rendered as shown in these examples.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							<code class="literal">DataStream</code>: An append-only storage option. Use this storage option when you want to publish or share data values. You can use the notation <code class="literal">DataSource.createStream()</code> to return a <code class="literal">DataStream&lt;T&gt;</code> object and use the method <code class="literal">append(T)</code> to add more data.
						</p><div class="formalpara"><p class="title"><strong>Example DataStream data source definition</strong></p><p>
								
<pre class="programlisting language-java">DataStream&lt;Temperature&gt; temperature = DataSource.createStream();
// Append value and notify all subscribers
temperature.append(new Temperature(100));</pre>
							</p></div></li><li class="listitem"><p class="simpara">
							<code class="literal">DataStore</code>: A writable storage option for adding or removing data and then notifying all subscribers that mutable data has been modified. Rules can pattern-match against incoming values and update or remove available values.
						</p><div class="formalpara"><p class="title"><strong>Example DataStore data source definition</strong></p><p>
								
<pre class="programlisting language-java">DataStore&lt;Temperature&gt; temperature = DataSource.createStore();
Temperature temp = new Temperature(100);
// Add value `t` and notify all subscribers
DataHandle t = temperature.add(temp);
temp.setValue(50);
// Notify all subscribers that the value referenced by `t` has changed
temperature.update(t, temp);
// Remove value referenced by `t` and notify all subscribers
temperature.remove(t);</pre>
							</p></div></li><li class="listitem"><p class="simpara">
							<code class="literal">SingletonStore</code>: A writable storage option for setting or clearing a single element and then notifying all subscribers that the element has been modified. Rules can pattern-match against the value and update or clear available values.
						</p><div class="formalpara"><p class="title"><strong>Example SingletonStore data source definition</strong></p><p>
								
<pre class="programlisting language-java">SingletonStore&lt;Temperature&gt; temperature = DataSource.createSingleton();
Temperature temp = new Temperature(100);
// Add value `temp` and notify all subscribers
temperature.set(temp);
temp.setValue(50);
// Notify all subscribers that the value has changed
temperature.update();

Temperature temp2 = new Temperature(200);
// Overwrite contained value with `temp2` and notify all subscribers
temperature.set(temp2);
temp2.setValue(150);
// Notify all subscribers that the value has changed
temperature.update();

// Clear store and notify all subscribers
temperature.clear();</pre>
							</p></div></li></ul></div><p>
					Subscribers to a data source are known as <span class="emphasis"><em>data processors</em></span>. A data processor implements the <code class="literal">DataProcessor&lt;T&gt;</code> interface. This interface contains callbacks to all the events that a subscribed data source can trigger.
				</p><div class="formalpara"><p class="title"><strong>Example DataStream data processor</strong></p><p>
						
<pre class="programlisting language-java">public interface DataProcessor&lt;T&gt; {
    void insert(DataHandle handle, T object);
    void update(DataHandle handle, T object);
    void delete(DataHandle handle);
}</pre>
					</p></div><p>
					The <code class="literal">DataHandle</code> method is an internal reference to an object of a data source. Each callaback method might or might not be invoked, depending on whether the corresponding data source implements the capability. For example, a <code class="literal">DataStream</code> source invokes only the <code class="literal">insert</code> callback, whereas a <code class="literal">SingletonStore</code> source invokes the <code class="literal">insert</code> callback on <code class="literal">set</code> and the <code class="literal">delete</code> callback on <code class="literal">clear</code> or before an overwriting <code class="literal">set</code>.
				</p></section><section class="section" id="drl_rule_unit_declaration_using_java"><div class="titlepage"><div><div><h2 class="title">9.3. DRL rule unit declaration using Java</h2></div></div></div><p>
					As an alternative to declaring fact types and rule units in DRL files, you can also declare types and units using Java classes. In this case, you add the source code to the <code class="literal">src/main/java</code> folder of your Kogito project instead of <code class="literal">src/main/resources</code>.
				</p><p>
					For example, the following Java classes define the type and rule unit declarations for the example temperature monitoring service:
				</p><div class="formalpara"><p class="title"><strong>Example Temperature class</strong></p><p>
						
<pre class="programlisting language-java">package com.acme;

public class Temperature {
    private final double value;
    public Temperature(double value) { this.value = value; }
    public double getValue() { return value; }
}</pre>
					</p></div><div class="formalpara"><p class="title"><strong>Example Alert class</strong></p><p>
						
<pre class="programlisting language-java">package com.acme;

public class Alert {
    private final String severity
    private final String message;
    public Temperature(String severity, String message) {
        this.severity = severity;
        this.message = message;
    }
    public String getSeverity() { return severity; }
    public String getMessage() { return message; }
}</pre>
					</p></div><div class="formalpara"><p class="title"><strong>Example rule unit class</strong></p><p>
						
<pre class="programlisting language-java">package com.acme;

import org.kie.kogito.rules.DataSource;
import org.kie.kogito.rules.DataStream;

public class MonitoringService implements RuleUnitData {
    private DataStream&lt;Temperature&gt; temperature = DataSource.createStream();
    private DataStream&lt;Alert&gt; alertData = DataSource.createStream();
    public DataStream&lt;Temperature&gt; getTemperature() { return temperature; }
    public DataStream&lt;Alert&gt; getAlertData() { return alertData; }
}</pre>
					</p></div><p>
					In this scenario, the DRL rule files then stand alone in the <code class="literal">src/main/resources</code> folder and consist of the <code class="literal">unit</code> and the rules, with no direct declarations, as shown in the following example:
				</p><div class="formalpara"><p class="title"><strong>Example DRL rule unit file without declarations</strong></p><p>
						
<pre class="screen">package com.acme;
unit MonitoringService;

rule "tooHot"
  when
    $temp : /temperature[value &gt;= 80]
  then
    alertData.append(new Alert("HIGH", "Temperature exceeds threshold: " + temp.value));
end</pre>
					</p></div></section><section class="section" id="drl_rule_units_with_bpmn_processes"><div class="titlepage"><div><div><h2 class="title">9.4. DRL rule units with BPMN processes</h2></div></div></div><p>
					If you use a DRL rule unit as part of a business rule task in a Business Process Model and Notation (BPMN) process in your Kogito project, you do not need to create an explicit data type declaration or a rule unit class that implements the <code class="literal">RuleUnitData</code> interface. Instead, you designate the rule unit in the DRL file as usual and specify the rule unit in the format <code class="literal">unit:<span class="emphasis"><em>PACKAGE_NAME</em></span>.<span class="emphasis"><em>UNIT_NAME</em></span></code> in the implementation details for the business rule task in the BPMN process. When you build the project, the business process implicitly declares the rule unit as part of the business rule task to execute the DRL file.
				</p><p>
					For example, the following is a DRL file with a rule unit designation:
				</p><div class="formalpara"><p class="title"><strong>Example DRL rule unit file</strong></p><p>
						
<pre class="screen">package com.acme;
unit MonitoringService;

rule "tooHot"
  when
    $temp : Temperature( value &gt;= 80 ) from temperature
  then
    alertData.add(new Alert("HIGH", "Temperature exceeds threshold: " + temp.value));
end</pre>
					</p></div><p>
					In the relevant business process in a BPMN 2.0 process modeler, you select the business rule task and for the <span class="strong strong"><strong>Implementation/Execution</strong></span> property, you set the rule language to <code class="literal">DRL</code> and the rule flow group to <code class="literal">unit:com.acme.MonitoringService</code>.
				</p><p>
					This rule unit syntax specifies that you are using the <code class="literal">com.acme.MonitoringService</code> rule unit instead of a traditional rule flow group. This is the rule unit that you referenced in the example DRL file. When you build the project, the business process implicitly declares the rule unit as part of the business rule task to execute the DRL file.
				</p></section></section><section class="chapter" id="con-drl-rules-conditions_drl-rules"><div class="titlepage"><div><div><h2 class="title">Chapter 10. Rule conditions in DRL</h2></div></div></div><p>
				The <code class="literal">when</code> part of a DRL rule (also known as the <span class="emphasis"><em>Left Hand Side (LHS)</em></span> of the rule) contains the conditions that must be met to execute an action. Conditions consist of a series of stated OOPath expressions of patterns and constraints, with optional bindings and supported rule condition elements (keywords), based on the available data objects in the package. OOPath is an object-oriented syntax extension to XPath for navigating through related elements while handling collections and filtering constraints.
			</p><p>
				For example, in a decision service that raises alerts when the temperature reaches or exceeds 80 degrees, a rule <code class="literal">tooHot</code> contains the <code class="literal">when</code> condition <code class="literal">/temperature[value &gt;= 80]</code>.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					DRL uses <code class="literal">when</code> instead of <code class="literal">if</code> because <code class="literal">if</code> is typically part of a procedural execution flow during which a condition is checked at a specific point in time. In contrast, <code class="literal">when</code> indicates that the condition evaluation is not limited to a specific evaluation sequence or point in time, but instead occurs continually at any time. Whenever the condition is met, the actions are executed.
				</p></div></div><p>
				If the <code class="literal">when</code> section is empty, then the conditions are considered to be true and the actions in the <code class="literal">then</code> section are executed the first time the rules are fired. This is useful if you want to use rules to set up the decision engine state.
			</p><p>
				The following example rule uses empty conditions to insert a fact every time the rule is executed:
			</p><div class="formalpara"><p class="title"><strong>Example rule without conditions</strong></p><p>
					
<pre class="screen">rule "start-up"
  when
    // Empty
  then   // Actions to be executed once
    alerts.add( new Alert("INFO", "System started") );
end</pre>
				</p></div><p>
				Formally, the core grammar of an OOPath expression is defined in extended Backus-Naur form (EBNF) notation in the following way:
			</p><div class="formalpara"><p class="title"><strong>EBNF notation for OOPath expressions</strong></p><p>
					
<pre class="screen">OOPExpr = [ID ( ":" | ":=" )] ( "/" | "?/" ) OOPSegment { ( "/" | "?/" | "." ) OOPSegment } ;
OOPSegment = ID ["#" ID] ["[" ( Number | Constraints ) "]"]</pre>
				</p></div><section class="section" id="oopath_expressions_and_constraints"><div class="titlepage"><div><div><h2 class="title">10.1. OOPath expressions and constraints</h2></div></div></div><p>
					An <span class="emphasis"><em>OOPath expression</em></span> of a pattern in a DRL rule condition is the segment to be matched by the decision engine. An OOPath expression can potentially match each fact that is inserted into the working memory of the decision engine. It can also contain constraints to further define the facts to be matched.
				</p><p>
					In the simplest form, with no constraints, an OOPath expression matches a fact in the given data source. In the following example with a <code class="literal">DataSource&lt;Person&gt;</code> named <code class="literal">person</code>, the expression matches against all <code class="literal">Person</code> objects in the data source of the decision engine:
				</p><div class="formalpara"><p class="title"><strong>Example expression for a single fact type</strong></p><p>
						
<pre class="screen">/person</pre>
					</p></div><p>
					Patterns can also refer to superclasses or even interfaces, potentially matching facts from many different classes. For example, the following pattern matches all <code class="literal">Student</code> subtypes of the <code class="literal">Person</code> object:
				</p><div class="formalpara"><p class="title"><strong>Example pattern for subtypes</strong></p><p>
						
<pre class="screen">/person # Student</pre>
					</p></div><p>
					Square brackets in a pattern enclose the constraints, such as the following constraint on the person’s age:
				</p><div class="formalpara"><p class="title"><strong>Example pattern with a constraint</strong></p><p>
						
<pre class="screen">/person[ age == 50 ]</pre>
					</p></div><p>
					A <span class="emphasis"><em>constraint</em></span> is an expression that returns <code class="literal">true</code> or <code class="literal">false</code>. Constraints in DRL are essentially Java expressions with some enhancements, such as property access, and some differences, such as <code class="literal">equals()</code> and <code class="literal">!equals()</code> semantics for <code class="literal">==</code> and <code class="literal">!=</code> (instead of the usual <code class="literal">same</code> and <code class="literal">not same</code> semantics).
				</p><p>
					Any JavaBeans property can be accessed directly from pattern constraints. A JavaBeans property is exposed internally using a standard JavaBeans getter that takes no arguments and returns something. For example, the <code class="literal">age</code> property is written as <code class="literal">age</code> in DRL instead of the getter <code class="literal">getAge()</code>:
				</p><div class="formalpara"><p class="title"><strong>DRL constraint syntax with JavaBeans properties</strong></p><p>
						
<pre class="screen">/person[ age == 50 ]

// This is equivalent to the following getter format:

/person[ getAge() == 50 ]</pre>
					</p></div><p>
					Kogito uses the standard JDK <code class="literal">Introspector</code> class to achieve this mapping and follows the standard JavaBeans specification. For optimal decision engine performance, use the property access format, such as <code class="literal">age</code>, instead of using getters explicitly, such as <code class="literal">getAge()</code>.
				</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						Do not use property accessors to change the state of the object in a way that might affect the rules because the decision engine caches the results of the match between invocations for higher efficiency.
					</p><p>
						For example, do not use property accessors in the following ways:
					</p><pre class="programlisting language-java">public int getAge() {
    age++; // Do not do this.
    return age;
}</pre><pre class="programlisting language-java">public int getAge() {
    Date now = DateUtil.now(); // Do not do this.
    return DateUtil.differenceInYears(now, birthday);
}</pre><p>
						Instead of following the second example, insert a fact that wraps the current date in the working memory and update that fact between rule executions as needed.
					</p></div></div><p>
					However, if the getter of a property cannot be found, the compiler uses the property name as a fallback method name, without arguments:
				</p><div class="formalpara"><p class="title"><strong>Fallback method if object is not found</strong></p><p>
						
<pre class="screen">/person[ age == 50 ]

// If `Person.getAge()` does not exist, the compiler uses the following syntax:

/person[ age() == 50 ]</pre>
					</p></div><p>
					You can also nest access properties in patterns, as shown in the following example. Nested properties are indexed by the decision engine.
				</p><div class="formalpara"><p class="title"><strong>Example pattern with nested property access</strong></p><p>
						
<pre class="screen">/person[ address.houseNumber == 50 ]

// This is equivalent to the following expression:

/person[ getAddress().getHouseNumber() == 50 ]</pre>
					</p></div><p>
					You can use any Java expression that returns a <code class="literal">boolean</code> value as a constraint inside the parentheses of a pattern. Java expressions can be mixed with other expression enhancements, such as property access:
				</p><div class="formalpara"><p class="title"><strong>Example pattern with a constraint using property access and Java expression</strong></p><p>
						
<pre class="screen">/person[ age == 50 ]</pre>
					</p></div><p>
					You can change the evaluation priority by using parentheses, as in any logical or mathematical expression:
				</p><div class="formalpara"><p class="title"><strong>Example evaluation order of constraints</strong></p><p>
						
<pre class="screen">/person[ age &gt; 100 &amp;&amp; ( age % 10 == 0 ) ]</pre>
					</p></div><p>
					You can also reuse Java methods in constraints, as shown in the following example:
				</p><div class="formalpara"><p class="title"><strong>Example constraints with reused Java methods</strong></p><p>
						
<pre class="screen">/person[ Math.round( weight / ( height * height ) ) &lt; 25.0 ]</pre>
					</p></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						Do not use constraints to change the state of the object in a way that might affect the rules because the decision engine caches the results of the match between invocations for higher efficiency. Any method that is executed on a fact in the rule conditions must be a read-only method. Also, the state of a fact should not change between rule invocations unless those facts are marked as updated in the working memory on every change.
					</p><p>
						For example, do not use a pattern constraint in the following ways:
					</p><pre class="screen">/person[ incrementAndGetAge() == 10 ] // Do not do this.</pre><pre class="screen">/person[ System.currentTimeMillis() % 1000 == 0 ] // Do not do this.</pre></div></div><p>
					Standard Java operator precedence applies to constraint operators in DRL, and DRL operators follow standard Java semantics except for the <code class="literal">==</code> and <code class="literal">!=</code> operators.
				</p><p>
					The <code class="literal">==</code> operator uses null-safe <code class="literal">equals()</code> semantics instead of the usual <code class="literal">same</code> semantics. For example, the pattern <code class="literal">/person[ firstName == "John" ]</code> is similar to <code class="literal">java.util.Objects.equals(person.getFirstName(), "John")</code>, and because <code class="literal">"John"</code> is not null, the pattern is also similar to <code class="literal">"John".equals(person.getFirstName())</code>.
				</p><p>
					The <code class="literal">!=</code> operator uses null-safe <code class="literal">!equals()</code> semantics instead of the usual <code class="literal">not same</code> semantics. For example, the pattern <code class="literal">/person[ firstName != "John" ]</code> is similar to <code class="literal">!java.util.Objects.equals(person.getFirstName(), "John")</code>.
				</p><p>
					If the field and the value of a constraint are of different types, the decision engine uses type coercion to resolve the conflict and reduce compilation errors. For instance, if <code class="literal">"ten"</code> is provided as a string in a numeric evaluator, a compilation error occurs, whereas <code class="literal">"10"</code> is coerced to a numeric 10. In coercion, the field type always takes precedence over the value type:
				</p><div class="formalpara"><p class="title"><strong>Example constraint with a value that is coerced</strong></p><p>
						
<pre class="screen">/person[ age == "10" ] // "10" is coerced to 10</pre>
					</p></div><p>
					For groups of constraints, you can use a delimiting comma <code class="literal">,</code> to use implicit <code class="literal">and</code> connective semantics:
				</p><div class="formalpara"><p class="title"><strong>Example patterns with multiple constraints</strong></p><p>
						
<pre class="screen">// Person is at least 50 years old and weighs at least 80 kilograms:
/person[ age &gt; 50, weight &gt; 80 ]

// Person is at least 50 years old, weighs at least 80 kilograms, and is taller than 2 meters:
/person[ age &gt; 50, weight &gt; 80, height &gt; 2 ]</pre>
					</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Although the <code class="literal">&amp;&amp;</code> and <code class="literal">,</code> operators have the same semantics, they are resolved with different priorities. The <code class="literal">&amp;&amp;</code> operator precedes the <code class="literal">||</code> operator, and both the <code class="literal">&amp;&amp;</code> and <code class="literal">||</code> operators together precede the <code class="literal">,</code> operator. Use the comma operator at the top-level constraint for optimal decision engine performance and human readability.
					</p></div></div><p>
					You cannot embed a comma operator in a composite constraint expression, such as in parentheses:
				</p><div class="formalpara"><p class="title"><strong>Example of misused comma in composite constraint expression</strong></p><p>
						
<pre class="screen">// Do not use the following format:
/person[ ( age &gt; 50, weight &gt; 80 ) || height &gt; 2 ]

// Use the following format instead:
/person[ ( age &gt; 50 &amp;&amp; weight &gt; 80 ) || height &gt; 2 ]</pre>
					</p></div></section><section class="section" id="bound_variables_in_patterns_and_constraints"><div class="titlepage"><div><div><h2 class="title">10.2. Bound variables in patterns and constraints</h2></div></div></div><p>
					You can bind variables to OOPath expressions of patterns and constraints to refer to matched objects in other portions of a rule. Bound variables can help you define rules more efficiently or more consistently with how you annotate facts in your data model.
				</p><p>
					For example, the following DRL rule uses the variable <code class="literal">$p</code> for an OOPath expression with the <code class="literal">Person</code> fact:
				</p><div class="formalpara"><p class="title"><strong>Pattern with a bound variable</strong></p><p>
						
<pre class="screen">rule "simple rule"
  when
    $p : /person
  then
    System.out.println( "Person " + p );
end</pre>
					</p></div><p>
					Similarly, you can also bind variables to nested properties, as shown in the following example:
				</p><pre class="screen">// Two persons of the same age:
/person[ firstAge : age ]  // Binding
and
/person[ age == firstAge ] // Constraint expression</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Ensure that you separate constraint bindings and constraint expressions for clearer and more efficient rule definitions. Although mixed bindings and expressions are supported, they can complicate patterns and affect evaluation efficiency.
					</p><pre class="screen">// Do not use the following format:
/person[ age : age * 2 &lt; 100 ]

// Use the following format instead:
/person[ age * 2 &lt; 100, $age : age ]</pre></div></div></section><section class="section" id="nested_constraints_and_inline_casts"><div class="titlepage"><div><div><h2 class="title">10.3. Nested constraints and inline casts</h2></div></div></div><p>
					In some cases, you might need to access multiple properties of a nested object, as shown in the following example:
				</p><div class="formalpara"><p class="title"><strong>Example pattern to access multiple properties</strong></p><p>
						
<pre class="screen">/person[ name == "mark", address.city == "london", address.country == "uk" ]</pre>
					</p></div><p>
					You can group these property accessors to nested objects for more readable rules, as shown in the following example:
				</p><div class="formalpara"><p class="title"><strong>Example pattern with grouped constraints</strong></p><p>
						
<pre class="screen">/person[ name == "mark"]/address[ city == "london", country == "uk" ]</pre>
					</p></div><p>
					When you work with nested objects, you can use the syntax <code class="literal"><span class="emphasis"><em>TYPE</em></span>#<span class="emphasis"><em>SUB_TYPE</em></span></code> to cast to a subtype and make the getters from the parent type available to the subtype. You can use either the object name or fully qualified class name, and you can cast to one or multiple subtypes, as shown in the following examples:
				</p><div class="formalpara"><p class="title"><strong>Example patterns with inline casting to a subtype</strong></p><p>
						
<pre class="screen">// Inline casting with subtype name:
/person[ name == "mark"]/address#LongAddress[ country == "uk" ]

// Inline casting with fully qualified class name:
/person[ name == "mark"]/address#org.domain.LongAddress[ country == "uk" ]

// Multiple inline casts:
/person[ name == "mark" ]/address#LongAddress/country#DetailedCountry[ population &gt; 10000000 ]</pre>
					</p></div><p>
					These example patterns cast <code class="literal">Address</code> to <code class="literal">LongAddress</code>, and additionally to <code class="literal">DetailedCountry</code> in the last example, making the parent getters available to the subtypes in each case.
				</p></section><section class="section" id="date_literal_in_constraints"><div class="titlepage"><div><div><h2 class="title">10.4. Date literal in constraints</h2></div></div></div><p>
					By default, the decision engine supports the date format <code class="literal">dd-mmm-yyyy</code>. You can customize the date format, including a time format mask if needed, by providing an alternative format mask with the system property <code class="literal">drools.dateformat="dd-mmm-yyyy hh:mm"</code>. You can also customize the date format by changing the language locale with the <code class="literal">drools.defaultlanguage</code> and <code class="literal">drools.defaultcountry</code> system properties. For example, the locale of Thailand is set as <code class="literal">drools.defaultlanguage=th</code> and <code class="literal">drools.defaultcountry=TH</code>.
				</p><div class="formalpara"><p class="title"><strong>Example pattern with a date literal restriction</strong></p><p>
						
<pre class="screen">/person[ bornBefore &lt; "27-Oct-2009" ]</pre>
					</p></div></section></section><section class="chapter" id="con-drl-rules-actions_drl-rules"><div class="titlepage"><div><div><h2 class="title">Chapter 11. Rule actions in DRL</h2></div></div></div><p>
				The <code class="literal">then</code> part of the rule (also known as the <span class="emphasis"><em>Right Hand Side (RHS)</em></span> of the rule) contains the actions to be performed when the conditional part of the rule has been met. Rule actions are typically determined by one or more <span class="emphasis"><em>data sources</em></span> that you define as part of your DRL rule unit. For example, if a bank requires loan applicants to have over 21 years of age (with a rule condition <code class="literal">/applicant[ applicantName : name, age &lt; 21 ]</code>) and a loan applicant is under 21 years old, the <code class="literal">then</code> action of an <code class="literal">"Underage"</code> rule would be <code class="literal">setApproved( false )</code> based on a defined data source, declining the loan because the applicant is under age.
			</p><p>
				The main purpose of rule actions is to to insert, delete, or modify data in the working memory of the decision engine. Effective rule actions are small, declarative, and readable. If you need to use imperative or conditional code in rule actions, then divide the rule into multiple smaller and more declarative rules.
			</p><div class="formalpara"><p class="title"><strong>Example rule for loan application age limit</strong></p><p>
					
<pre class="screen">rule "Underage"
  when
    /applicant[ applicantName : name, age &lt; 21 ]
    $application : /loanApplication[ applicant == applicantName ]
  then
    $application.setApproved( false );
    $application.setExplanation( "Underage" );
end</pre>
				</p></div><p>
				For more information about using data sources for rule actions, see <a class="xref" href="#con-drl-rule-units_drl-rules" title="Chapter 9. Rule units in DRL">Chapter 9, <em>Rule units in DRL</em></a>.
			</p></section><section class="chapter" id="con-property-change-listeners_drl-rules"><div class="titlepage"><div><div><h2 class="title">Chapter 12. Property-change settings and listeners for fact types</h2></div></div></div><p>
				By default, the decision engine does not re-evaluate all fact patterns for fact types each time a rule is triggered, but instead reacts only to modified properties that are constrained or bound inside a given pattern. For example, if a rule calls <code class="literal">modify()</code> on a fact as part of the rule actions, this modification does not automatically trigger the re-evaluation of all patterns referring to the modified type. Only the patterns constrained on the changed properties of that fact are re-evaluated. This property reactivity behavior prevents unwanted recursions and results in more efficient rule evaluation. This behavior also avoids the need of using the <code class="literal">no-loop</code> rule attribute to prevent infinite recursion.
			</p><p>
				You can modify or disable this property reactivity behavior with the following options, and then use a property-change setting in your Java class or DRL files to fine-tune property reactivity as needed:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">ALWAYS</code>: (Default) All types are property reactive, but you can disable property reactivity for a specific type by using the <code class="literal">@classReactive</code> property-change setting.
					</li><li class="listitem">
						<code class="literal">ALLOWED</code>: No types are property reactive, but you can enable property reactivity for a specific type by using the <code class="literal">@propertyReactive</code> property-change setting.
					</li><li class="listitem">
						<code class="literal">DISABLED</code>: No types are property reactive. All property-change listeners are ignored.
					</li></ul></div><p>
				To set the property reactivity behavior, update the <code class="literal">drools.propertySpecific</code> system property in the <code class="literal">application.properties</code> file of your Kogito project:
			</p><div class="formalpara"><p class="title"><strong>Example property reactivity setting in system properties</strong></p><p>
					
<pre class="screen">drools.propertySpecific=ALLOWED</pre>
				</p></div><p>
				The decision engine supports the following property-change settings and listeners for fact classes or declared DRL fact types:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">@classReactive</span></dt><dd><p class="simpara">
							If property reactivity is set to <code class="literal">ALWAYS</code> in the decision engine (all types are property reactive), this tag disables the default property reactivity behavior for a specific Java class or a declared DRL fact type. You can use this tag if you want the decision engine to re-evaluate all fact patterns for the specified fact type each time the rule is triggered, instead of reacting only to modified properties that are constrained or bound inside a given pattern.
						</p><div class="formalpara"><p class="title"><strong>Example: Disable default property reactivity in a DRL type declaration</strong></p><p>
								
<pre class="screen">declare Person
  @classReactive
    firstName : String
    lastName : String
end</pre>
							</p></div><div class="formalpara"><p class="title"><strong>Example: Disable default property reactivity in a Java class</strong></p><p>
								
<pre class="programlisting language-java">@classReactive
public static class Person {
    private String firstName;
    private String lastName;
}</pre>
							</p></div></dd><dt><span class="term">@propertyReactive</span></dt><dd><p class="simpara">
							If property reactivity is set to <code class="literal">ALLOWED</code> in the decision engine (no types are property reactive unless specified), this tag enables property reactivity for a specific Java class or a declared DRL fact type. You can use this tag if you want the decision engine to react only to modified properties that are constrained or bound inside a given pattern for the specified fact type, instead of re-evaluating all fact patterns for the fact each time the rule is triggered.
						</p><div class="formalpara"><p class="title"><strong>Example: Enable property reactivity in a DRL type declaration (when reactivity is disabled globally)</strong></p><p>
								
<pre class="screen">declare Person
  @propertyReactive
    firstName : String
    lastName : String
end</pre>
							</p></div><div class="formalpara"><p class="title"><strong>Example: Enable property reactivity in a Java class (when reactivity is disabled globally)</strong></p><p>
								
<pre class="programlisting language-java">@propertyReactive
public static class Person {
    private String firstName;
    private String lastName;
}</pre>
							</p></div></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">@propertyChangeSupport</span></dt><dd><p class="simpara">
							For facts that implement support for property changes as defined in the <a class="link" href="https://download.oracle.com/otndocs/jcp/7224-javabeans-1.01-fr-spec-oth-JSpec/">JavaBeans Specification</a>, this tag enables the decision engine to monitor changes in the fact properties.
						</p><div class="formalpara"><p class="title"><strong>Example: Declare property change support in JavaBeans object</strong></p><p>
								
<pre class="screen">declare Person
    @propertyChangeSupport
end</pre>
							</p></div></dd></dl></div></section><section class="chapter" id="proc-drl-rules-central-create_drl-rules"><div class="titlepage"><div><div><h2 class="title">Chapter 13. Creating DRL rules for your Kogito project</h2></div></div></div><p>
				You can create and manage DRL rules for your Kogito project in your integrated development environment (IDE). For Kogito service, VSCode is the preferred IDE. In each DRL rule file, you define rule conditions, actions, and other components related to the rule, based on the data objects you create or import in the package.
			</p><p>
				In Kogito, you typically define DRL rules in rule units. A DRL rule unit is a module for rules and a unit of execution. A rule unit collects a set of rules with the declaration of the type of facts that the rules act on. A rule unit also serves as a unique namespace for each group of rules. A single rule base can contain multiple rule units. You typically store all the rules for a unit in the same file as the unit declaration so that the unit is self-contained.
			</p><p>
				For this procedure, create the following example DRL type declarations and DRL rule unit to define DRL rules in a decision service for a loan application:
			</p><div class="formalpara"><p class="title"><strong>Example DRL type declarations for a loan application</strong></p><p>
					
<pre class="screen">package org.mortgages;

declare Bankruptcy
    name: String
    yearOfOccurrence: int
end

declare Applicant
    name: String
    age: int
end

declare LoanApplication
    applicant: String
    approved: boolean
    explanation: String
end</pre>
				</p></div><div class="formalpara"><p class="title"><strong>Example DRL rule unit file for a loan application</strong></p><p>
					
<pre class="screen">package org.mortgages;
unit MortgageRules;

import org.kie.kogito.rules.DataSource;
import org.kie.kogito.rules.DataStream;

declare MortgageRules extends RuleUnitData
  bankruptcy: DataStore&lt;Bankruptcy&gt; = DataSource.createStore()
  applicant: DataStore&lt;Applicant&gt; = DataSource.createStore()
  application: DataStore&lt;LoanApplication&gt; = DataSource.createStore()
end

rule "Bankruptcy history"
	salience 10
	when
    $a : /loanApplication[ applicantName: applicant ]
    exists (/bankruptcy[ name == applicantName, yearOfOccurrence &gt; 1990 || amountOwed &gt; 100000 ])
	then
		$a.setApproved( false );
		$a.setExplanation( "has been bankrupt" );
		loanApplication.remove( $a );
end

rule "Underage"
	salience 15
	when
    /applicant[ applicantName : name, age &lt; 21 ]
    $application : /loanApplication[ applicant == applicantName ]
	then
		$application.setApproved( false );
		$application.setExplanation( "Underage" );
		loanApplication.remove( $a );
end</pre>
				</p></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have created a Kogito project and have included any Java data objects required for your Kogito service. For information about creating a project, see <a class="link" href="https://access.redhat.com/documentation/en-us/kogito/0.9/html-single/creating_and_running_your_first_kogito_services"><span class="emphasis"><em>Creating and running your first Kogito services</em></span></a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In your VSCode IDE, open your Kogito project and create a <code class="literal">src/main/resources/org/mortgages</code> folder. This folder serves as the package for your DRL files in this example.
					</li><li class="listitem"><p class="simpara">
						In your new <code class="literal">src/main/resources/org/mortgages</code> folder, add the following <code class="literal">ApplicationTypes.drl</code> file to define the fact types for the loan application service:
					</p><div class="formalpara"><p class="title"><strong>Example DRL type declarations for a loan application</strong></p><p>
							
<pre class="screen">package org.mortgages;

declare Bankruptcy
    name: String
    yearOfOccurrence: int
end

declare Applicant
    name: String
    age: int
end

declare LoanApplication
    applicant: String
    approved: boolean
    explanation: String
end</pre>
						</p></div><p class="simpara">
						This DRL file defines the fact types that you can declare in any rule units in the same package for the decision service. Declarations in DRL files define new fact types or metadata for fact types to be used by rules in a DRL files. If you declare these types directly in the DRL rule unit file, you cannot declare them in any other rule units.
					</p><p class="simpara">
						This example defines the following fact types:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<code class="literal">Bankruptcy</code>: Provides data for bankruptcy status, if applicable
							</li><li class="listitem">
								<code class="literal">Applicant</code>: Provides data about the loan applicant
							</li><li class="listitem">
								<code class="literal">LoanApplication</code>: Provides data about loan approval status for a specified applicant, with an explanation if needed
							</li></ul></div></li><li class="listitem"><p class="simpara">
						In the same <code class="literal">src/main/resources/org/mortgages</code> folder of your Kogito project, create the following <code class="literal">LoanApplication.drl</code> file to declare the DRL rule unit and data sources:
					</p><div class="formalpara"><p class="title"><strong>Example DRL file with rule unit and data sources</strong></p><p>
							
<pre class="screen">package org.mortgages;
unit MortgageRules;

import org.kie.kogito.rules.DataSource;
import org.kie.kogito.rules.DataStore;

declare MortgageRules extends RuleUnitData
  bankruptcy: DataStore&lt;Bankruptcy&gt; = DataSource.createStore()
  applicant: DataStore&lt;Applicant&gt; = DataSource.createStore()
  application: DataStore&lt;LoanApplication&gt; = DataSource.createStore()
end
...</pre>
						</p></div><p class="simpara">
						In this example, the rule unit is named <code class="literal">MortgageRules</code> and the previously defined fact types are declared as <code class="literal">DataStore</code> data sources.
					</p><p class="simpara">
						Data sources are typed sources of data that rule units can subscribe to for updates. You interact with the rule unit through the data sources it exposes. A data source can be a <code class="literal">DataStream</code> source for append-only storage, a <code class="literal">DataStore</code> source for writable storage to add or remove data, or a <code class="literal">SingletonStore</code> source for writable storage to set and clear a single element.
					</p><p class="simpara">
						This example uses the <code class="literal">DataStore</code> data source to enable application data to be added or removed as part of the decision service.
					</p></li><li class="listitem"><p class="simpara">
						To complete the DRL rule unit file, add the following rules for <code class="literal">"Bankruptcy history"</code> and <code class="literal">"Underage"</code> logic:
					</p><div class="formalpara"><p class="title"><strong>Example DRL rule unit file for a loan application</strong></p><p>
							
<pre class="screen">package org.mortgages;
unit MortgageRules;

import org.kie.kogito.rules.DataSource;
import org.kie.kogito.rules.DataStream;

declare MortgageRules extends RuleUnitData
  bankruptcy: DataStore&lt;Bankruptcy&gt; = DataSource.createStore()
  applicant: DataStore&lt;Applicant&gt; = DataSource.createStore()
  application: DataStore&lt;LoanApplication&gt; = DataSource.createStore()
end

rule "Bankruptcy history"
	salience 10
	when
    $a : /loanApplication[ applicantName: applicant ]
    exists (/bankruptcy[ name == applicantName, yearOfOccurrence &gt; 1990 || amountOwed &gt; 100000 ])
	then
		$a.setApproved( false );
		$a.setExplanation( "has been bankrupt" );
		loanApplication.remove( $a );
end

rule "Underage"
	salience 15
	when
    /applicant[ applicantName : name, age &lt; 21 ]
    $application : /loanApplication[ applicant == applicantName ]
	then
		$application.setApproved( false );
		$application.setExplanation( "Underage" );
		loanApplication.remove( $a );
end</pre>
						</p></div><p class="simpara">
						The example rules consist of the following rule components:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								<code class="literal">rule</code>: Use this segment to define each rule in the DRL file. Rules consist of a rule name in the format <code class="literal">rule "rule name"</code>, followed by optional attributes that define rule behavior, such as <code class="literal">salience</code> or <code class="literal">no-loop</code>, followed by <code class="literal">when</code> and <code class="literal">then</code> definitions. Each rule must have a unique name within the rule package.
							</p><p class="simpara">
								In this example, the <code class="literal">"Bankruptcy history"</code> rule has a defined salience of <code class="literal">10</code> and the <code class="literal">"Underage"</code> rule has a defined salience of <code class="literal">15</code>. These values ensure that the <code class="literal">"Bankruptcy history"</code> rule is executed first.
							</p></li><li class="listitem"><p class="simpara">
								<code class="literal">when</code> and <code class="literal">then</code>: Use the <code class="literal">when</code> portion to define the condition patterns and constraints in OOPath syntax and use the <code class="literal">then</code> portion to define the actions to be executed when the conditions are met.
							</p><p class="simpara">
								In this example, the <code class="literal">"Bankruptcy history"</code> rule states that if an applicant has owed more than 100,000 USD of unresolved debt since 1990 (beginning 1991), then the applicant is considered to have been bankrupt and is not approved for a loan. The application is removed from memory.
							</p><p class="simpara">
								If the applicant passes the bankruptcy check, then the <code class="literal">"Underage"</code> rule states that if the applicant is younger than 21 years old, then the applicant is not approved for the loan. The application is removed from memory.
							</p><p class="simpara">
								If the applicant passes both checks, then the loan is approved.
							</p></li></ul></div></li><li class="listitem">
						After you define all components of the data sources and rules, save all DRL files.
					</li></ol></div><div class="itemizedlist"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="xref" href="#con-drl-rule-units_drl-rules" title="Chapter 9. Rule units in DRL">Chapter 9, <em>Rule units in DRL</em></a>
					</li><li class="listitem">
						<a class="xref" href="#con-drl-rules-conditions_drl-rules" title="Chapter 10. Rule conditions in DRL">Chapter 10, <em>Rule conditions in DRL</em></a>
					</li><li class="listitem">
						<a class="xref" href="#con-drl-rules-actions_drl-rules" title="Chapter 11. Rule actions in DRL">Chapter 11, <em>Rule actions in DRL</em></a>
					</li></ul></div></section><section class="chapter" id="con-kogito-service-execution_drl-rules"><div class="titlepage"><div><div><h2 class="title">Chapter 14. Kogito service execution</h2></div></div></div><p>
				After you design your Kogito service, you can build and run your application and then send REST API requests to the application to execute your services. The exact REST API requests that you can use depend on how you set up the application.
			</p><p>
				For example, consider a Kogito service that is set up to generate a <code class="literal">/persons</code> REST API endpoint and determines whether a specified customer is an adult or is underage. In this example, you can send the following <code class="literal">POST</code> request using a REST client or curl utility to add an adult and execute the service:
			</p><div class="formalpara"><p class="title"><strong>Example POST request body to add an adult (JSON)</strong></p><p>
					
<pre class="programlisting language-json">{
  "person": {
    "name": "John Quark",
    "age": 20
  }
}</pre>
				</p></div><div class="formalpara"><p class="title"><strong>Example curl command to add an adult</strong></p><p>
					
<pre class="screen">curl -X POST http://localhost:8080/persons -H 'content-type: application/json' -H 'accept: application/json' -d '{"person": {"name":"John Quark", "age": 20}}'</pre>
				</p></div><div class="formalpara"><p class="title"><strong>Example response (JSON)</strong></p><p>
					
<pre class="programlisting language-json">{
  "id": "3af806dd-8819-4734-a934-728f4c819682",
  "person": {
    "name": "John Quark",
    "age": 20,
    "adult": false
  },
  "isAdult": true
}</pre>
				</p></div><p>
				For information about creating, running, and testing an example application with Kogito services, see
			</p><p>
				For information about deploying your Kogito service to Red Hat OpenShift Container Platform, see
			</p></section></div><div class="part" id="chap-kogito-using-spreadsheet-decision-tables"><div class="titlepage"><div><div><h1 class="title">Part III. Using spreadsheet decision tables in Kogito services</h1></div></div></div><div class="partintro" id="idm139794253804400"><div/><p>
				As a developer of business decisions, you can define business rules in a tabular format in spreadsheet decision tables and then include the spreadsheet file in your Kogito project. These rules are compiled into Drools Rule Language (DRL) for the decision service in your project.
			</p><div class="toc"><p><strong>Table of Contents</strong></p><ul class="toc"><li><span class="chapter"><a href="#con-decision-tables_decision-tables">15. Spreadsheet decision tables</a></span></li><li><span class="chapter"><a href="#con-decision-tables-use-case_decision-tables">16. Decision table use case</a></span></li><li><span class="chapter"><a href="#proc-decision-tables-creating_decision-tables">17. Creating spreadsheet decision tables for your Kogito project</a></span><ul><li><span class="section"><a href="#ref-decision-tables-rule-set-entries_decision-tables">17.1. RuleSet definitions</a></span></li><li><span class="section"><a href="#ref-decision-tables-rule-table-entries_decision-tables">17.2. RuleTable definitions</a></span></li><li><span class="section"><a href="#ref-decision-tables-attributes_decision-tables">17.3. Additional rule attributes for RuleSet or RuleTable definitions</a></span></li></ul></li><li><span class="chapter"><a href="#con-kogito-service-execution_decision-tables">18. Kogito service execution</a></span></li></ul></div></div><section class="chapter" id="con-decision-tables_decision-tables"><div class="titlepage"><div><div><h2 class="title">Chapter 15. Spreadsheet decision tables</h2></div></div></div><p>
				Spreadsheet decision tables are XLS or XLSX spreadsheet files that contain business rules defined in a tabular format. You can include spreadsheet decision tables as part of your Kogito project. Each row in a decision table is a rule, and each column is a condition, an action, or another rule attribute. After you create and include your spreadsheet decision tables in your project, the rules you defined are compiled into Drools Rule Language (DRL) rules for the decision service.
			</p></section><section class="chapter" id="con-decision-tables-use-case_decision-tables"><div class="titlepage"><div><div><h2 class="title">Chapter 16. Decision table use case</h2></div></div></div><p>
				An online shopping site lists the shipping charges for ordered items. The site provides free shipping under the following conditions:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The number of items ordered is 4 or more and the checkout total is $300 or more.
					</li><li class="listitem">
						Standard shipping is selected (4 or 5 business days from the date of purchase).
					</li></ul></div><p>
				The following are the shipping rates under these conditions:
			</p><div class="table" id="idm139794253265648"><p class="title"><strong>Table 16.1. For orders less than $300</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm139794253259872" scope="col">Number of items</th><th align="left" valign="top" id="idm139794253258784" scope="col">Delivery day</th><th align="left" valign="top" id="idm139794253257696" scope="col">Shipping charge in USD, N = Number of items</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139794253259872">
							<p>
								3 or fewer
							</p>
							</td><td align="left" valign="top" headers="idm139794253258784">
							<p>
								Next day
							</p>
							<p>
								2nd day
							</p>
							<p>
								Standard
							</p>
							</td><td align="left" valign="top" headers="idm139794253257696">
							<p>
								35
							</p>
							<p>
								15
							</p>
							<p>
								10
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm139794253259872">
							<p>
								4 or more
							</p>
							</td><td align="left" valign="top" headers="idm139794253258784">
							<p>
								Next day
							</p>
							<p>
								2nd day
							</p>
							<p>
								Standard
							</p>
							</td><td align="left" valign="top" headers="idm139794253257696">
							<p>
								N*7.50
							</p>
							<p>
								N*3.50
							</p>
							<p>
								N*2.50
							</p>
							</td></tr></tbody></table></div></div><div class="table" id="idm139794252688976"><p class="title"><strong>Table 16.2. For orders more than $300</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"/><col style="width: 33%; " class="col_2"/><col style="width: 33%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm139794252683200" scope="col">Number of items</th><th align="left" valign="top" id="idm139794252682112" scope="col">Delivery day</th><th align="left" valign="top" id="idm139794253364560" scope="col">Shipping charge in USD, N = Number of items</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139794252683200">
							<p>
								3 or fewer
							</p>
							</td><td align="left" valign="top" headers="idm139794252682112">
							<p>
								Next day
							</p>
							<p>
								2nd day
							</p>
							<p>
								Standard
							</p>
							</td><td align="left" valign="top" headers="idm139794253364560">
							<p>
								25
							</p>
							<p>
								10
							</p>
							<p>
								N*1.50
							</p>
							</td></tr><tr><td align="left" valign="top" headers="idm139794252683200">
							<p>
								4 or more
							</p>
							</td><td align="left" valign="top" headers="idm139794252682112">
							<p>
								Next day
							</p>
							<p>
								2nd day
							</p>
							<p>
								Standard
							</p>
							</td><td align="left" valign="top" headers="idm139794253364560">
							<p>
								N*5
							</p>
							<p>
								N*2
							</p>
							<p>
								FREE
							</p>
							</td></tr></tbody></table></div></div><p>
				These conditions and rates are shown in the following example spreadsheet decision table:
			</p><div class="figure" id="idm139794253347600"><p class="title"><strong>Figure 16.1. Decision table for shipping charges</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/decision-tables/decision-table-example-02.png" alt="Decision table example"/></div></div></div><p>
				In order for a decision table to be compiled in your Kogito project, the table must comply with certain structure and syntax requirements within an XLS or XLSX spreadsheet, as shown in this example. For more information, see <a class="xref" href="#proc-decision-tables-creating_decision-tables" title="Chapter 17. Creating spreadsheet decision tables for your Kogito project">Chapter 17, <em>Creating spreadsheet decision tables for your Kogito project</em></a>.
			</p></section><section class="chapter" id="proc-decision-tables-creating_decision-tables"><div class="titlepage"><div><div><h2 class="title">Chapter 17. Creating spreadsheet decision tables for your Kogito project</h2></div></div></div><p>
				Spreadsheet decision tables (XLS or XLSX) require two key areas that define rule data: a <code class="literal">RuleSet</code> area and a <code class="literal">RuleTable</code> area. The <code class="literal">RuleSet</code> area of the spreadsheet defines elements that you want to apply globally to all rules in the same package (not only the spreadsheet), such as a rule set name or universal rule attributes. The <code class="literal">RuleTable</code> area defines the actual rules (rows) and the conditions, actions, and other rule attributes (columns) that constitute that rule table within the specified rule set. A spreadsheet of decision tables can contain multiple <code class="literal">RuleTable</code> areas, but only one <code class="literal">RuleSet</code> area.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					For each Kogito project, try to include only one spreadsheet of decision tables, containing all necessary <code class="literal">RuleTable</code> definitions. Although you can include separate decision table spreadsheets, including multiple spreadsheets in the same project package can cause compilation errors from conflicting <code class="literal">RuleSet</code> or <code class="literal">RuleTable</code> attributes and is therefore not recommended.
				</p></div></div><p>
				Refer to the following sample spreadsheet as you define your decision table:
			</p><div class="figure" id="idm139794253289824"><p class="title"><strong>Figure 17.1. Sample spreadsheet decision table for shipping charges</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/decision-tables/decision-table-example-02.png" alt="Decision table example"/></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						You have added the following dependency to the <code class="literal">pom.xml</code> file of your Kogito project to enable decision tables for decision services:
					</p><div class="formalpara"><p class="title"><strong>Dependency to enable decision tables for decision services</strong></p><p>
							
<pre class="screen">&lt;dependency&gt;
    &lt;groupId&gt;org.kie.kogito&lt;/groupId&gt;
    &lt;artifactId&gt;drools-decisiontables&lt;/artifactId&gt;
&lt;/dependency&gt;</pre>
						</p></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In a new XLS or XLSX spreadsheet, go to the second or third column and label a cell <code class="literal">RuleSet</code> (row 1 in example). Reserve the column or columns to the left for descriptive metadata (optional).
					</li><li class="listitem">
						In the next cell to the right, enter a name for the <code class="literal">RuleSet</code>. This named rule set will contain all <code class="literal">RuleTable</code> rules defined in the rule package.
					</li><li class="listitem">
						Under the <code class="literal">RuleSet</code> cell, define any rule attributes (one per cell) that you want to apply globally to all rule tables in the package. Specify attribute values in the cells to the right. For example, you can enter an <code class="literal">Import</code> label and in the cell to the right, specify relevant data objects from other packages that you want to import into the package for the decision table (in the format <code class="literal">package.name.object.name</code>). For supported cell labels and values, see <a class="xref" href="#ref-decision-tables-rule-set-entries_decision-tables" title="17.1. RuleSet definitions">Section 17.1, “RuleSet definitions”</a>.
					</li><li class="listitem">
						Below the <code class="literal">RuleSet</code> area and in the same column as the <code class="literal">RuleSet</code> cell, skip a row and label a new cell <code class="literal">RuleTable</code> (row 7 in example) and enter a table name in the same cell. The name is used as the initial part of the name for all rules derived from this rule table, with the row number appended for distinction. You can override this automatic naming by inserting a <code class="literal">NAME</code> attribute column.
					</li><li class="listitem"><p class="simpara">
						Use the next four rows to define the following elements as needed (rows 8-11 in example):
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>Rule attributes:</strong></span> Conditions, actions, or other attributes. For supported cell labels and values, see <a class="xref" href="#ref-decision-tables-rule-table-entries_decision-tables" title="17.2. RuleTable definitions">Section 17.2, “RuleTable definitions”</a>.
							</li><li class="listitem">
								<span class="strong strong"><strong>Object types:</strong></span> The data objects to which the rule attributes apply. If the same object type applies to multiple columns, merge the object cells into one cell across multiple columns (as shown in the sample decision table), instead of repeating the object type in multiple cells. When an object type is merged, all columns below the merged range will be combined into one set of constraints within a single pattern for matching a single fact at a time. When an object is repeated in separate columns, the separate columns can create different patterns, potentially matching different or identical facts.
							</li><li class="listitem">
								<span class="strong strong"><strong>Constraints:</strong></span> Constraints on the object types.
							</li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Column label:</strong></span> (Optional) Any descriptive label for the column, as a visual aid. Leave blank if unused.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									As an alternative to populating both the object type and constraint cells, you can leave the object type cell or cells empty and enter the full expression in the corresponding constraint cell or cells. For example, instead of <code class="literal">Order</code> as the object type and <code class="literal">itemsCount &gt; $1</code> as a constraint (separate cells), you can leave the object type cell empty and enter <code class="literal">Order( itemsCount &gt; $1 )</code> in the constraint cell, and then do the same for other constraint cells.
								</p></div></div></li></ul></div></li><li class="listitem"><p class="simpara">
						After you have defined all necessary rule attributes (columns), enter values for each column as needed, row by row, to generate rules (rows 12-17 in example). Cells with no data are ignored (such as when a condition or action does not apply).
					</p><p class="simpara">
						If you need to add more rule tables to this decision table spreadsheet, skip a row after the last rule in the previous table, label another <code class="literal">RuleTable</code> cell in the same column as the previous <code class="literal">RuleTable</code> and <code class="literal">RuleSet</code> cells, and create the new table following the same steps in this section (rows 19-29 in example).
					</p></li><li class="listitem">
						Save your XLS or XLSX spreadsheet to finish.
					</li><li class="listitem">
						In your VSCode IDE, import the XLS or XLSX spreadsheet file in the relevant folder of your Kogito project, typically in <code class="literal">src/main/resources</code>.
					</li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Only the first worksheet in a spreadsheet workbook is processed as a decision table when you include the spreadsheet in your Kogito project. Each <code class="literal">RuleSet</code> name combined with the <code class="literal">RuleTable</code> name must be unique across all decision table files in the same package.
				</p></div></div><p>
				After you include the decision table in your Kogito project, the rules are rendered as DRL rules like the following example, from the sample spreadsheet:
			</p><pre class="screen">//row 12
rule "Basic_12"
salience 10
  when
    $order : /orders[ itemsCount &gt; 0, itemsCount &lt;= 3, deliverInDays == 1 ]
  then
    insert( new Charge( 35 ) );
end</pre><div class="admonition note"><div class="admonition_header">Enabling white space used in cell values</div><div><p>
					By default, any white space before or after values in decision table cells is removed before the decision table is processed by the decision engine. To retain white space that you use intentionally before or after values in cells, set the <code class="literal">drools.trimCellsInDTable</code> system property to <code class="literal">false</code> in the <code class="literal">application.properties</code> file of your Kogito project:
				</p><div class="formalpara"><p class="title"><strong>Enable white space in <code class="literal">application.properties</code></strong></p><p>
						
<pre class="screen">drools.trimCellsInDTable=false</pre>
					</p></div><p>
					You can also set this property as a start-up option when you build your Kogito project:
				</p><div class="formalpara"><p class="title"><strong>On Quarkus</strong></p><p>
						
<pre class="screen">mvn compile quarkus:dev -Ddrools.trimCellsInDTable=false</pre>
					</p></div><div class="formalpara"><p class="title"><strong>On Spring Boot</strong></p><p>
						
<pre class="screen">mvn spring-boot:run -Ddrools.trimCellsInDTable=false</pre>
					</p></div></div></div><section class="section" id="ref-decision-tables-rule-set-entries_decision-tables"><div class="titlepage"><div><div><h2 class="title">17.1. RuleSet definitions</h2></div></div></div><p>
					Entries in the <code class="literal">RuleSet</code> area of a decision table define DRL constructs and rule attributes that you want to apply to all rules in a package (not only in the spreadsheet). Entries must be in a vertically stacked sequence of cell pairs, where the first cell contains a label and the cell to the right contains the value. A decision table spreadsheet can have only one <code class="literal">RuleSet</code> area.
				</p><p>
					The following table lists the supported labels and values for <code class="literal">RuleSet</code> definitions:
				</p><div class="table" id="idm139794251834000"><p class="title"><strong>Table 17.1. Supported <code class="literal">RuleSet</code> definitions</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 30%; " class="col_1"/><col style="width: 40%; " class="col_2"/><col style="width: 30%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm139794254030144" scope="col">Label</th><th align="left" valign="top" id="idm139794254029056" scope="col">Value</th><th align="left" valign="top" id="idm139794254027968" scope="col">Usage</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139794254030144">
								<p>
									<code class="literal">RuleSet</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794254029056">
								<p>
									The package name for the generated DRL file. Optional, the default is <code class="literal">rule_table</code>.
								</p>
								</td><td align="left" valign="top" headers="idm139794254027968">
								<p>
									Must be the first entry.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794254030144">
								<p>
									<code class="literal">Unit</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794254029056">
								<p>
									The name of the rule unit for the generated DRL file.
								</p>
								</td><td align="left" valign="top" headers="idm139794254027968">
								<p>
									Recommended for optimal rule grouping and execution.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794254030144">
								<p>
									<code class="literal">Sequential</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794254029056">
								<p>
									<code class="literal">true</code> or <code class="literal">false</code>. If <code class="literal">true</code>, then salience is used to ensure that rules fire from the top down.
								</p>
								</td><td align="left" valign="top" headers="idm139794254027968">
								<p>
									Optional, at most once. If omitted, no firing order is imposed.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794254030144">
								<p>
									<code class="literal">SequentialMaxPriority</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794254029056">
								<p>
									Integer numeric value.
								</p>
								</td><td align="left" valign="top" headers="idm139794254027968">
								<p>
									Optional, at most once. In sequential mode, this option is used to set the start value of the salience. If omitted, the default value is <code class="literal">65535</code>.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794254030144">
								<p>
									<code class="literal">SequentialMinPriority</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794254029056">
								<p>
									Integer numeric value.
								</p>
								</td><td align="left" valign="top" headers="idm139794254027968">
								<p>
									Optional, at most once. In sequential mode, this option is used to check if this minimum salience value is not violated. If omitted, the default value is <code class="literal">0</code>.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794254030144">
								<p>
									<code class="literal">EscapeQuotes</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794254029056">
								<p>
									<code class="literal">true</code> or <code class="literal">false</code>. If <code class="literal">true</code>, then quotation marks are escaped so that they appear literally in the DRL.
								</p>
								</td><td align="left" valign="top" headers="idm139794254027968">
								<p>
									Optional, at most once. If omitted, quotation marks are escaped.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794254030144">
								<p>
									<code class="literal">Import</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794254029056">
								<p>
									A comma-separated list of Java classes to import from another package.
								</p>
								</td><td align="left" valign="top" headers="idm139794254027968">
								<p>
									Optional, may be used repeatedly.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794254030144">
								<p>
									<code class="literal">Queries</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794254029056">
								<p>
									One or more query definitions, according to DRL syntax.
								</p>
								</td><td align="left" valign="top" headers="idm139794254027968">
								<p>
									Optional, may be used repeatedly.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794254030144">
								<p>
									<code class="literal">Declare</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794254029056">
								<p>
									One or more declarative types, according to DRL syntax.
								</p>
								</td><td align="left" valign="top" headers="idm139794254027968">
								<p>
									Optional, may be used repeatedly.
								</p>
								</td></tr></tbody></table></div></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						In some cases, Microsoft Office, LibreOffice, and OpenOffice might encode a double quotation mark differently, causing a compilation error. For example, <code class="literal">“A”</code> fails, but <code class="literal">"A"</code> succeeds.
					</p></div></div></section><section class="section" id="ref-decision-tables-rule-table-entries_decision-tables"><div class="titlepage"><div><div><h2 class="title">17.2. RuleTable definitions</h2></div></div></div><p>
					Entries in the <code class="literal">RuleTable</code> area of a decision table define conditions, actions, and other rule attributes for the rules in that rule table. A spreadsheet of decision tables can contain multiple <code class="literal">RuleTable</code> areas.
				</p><p>
					The following table lists the supported labels (column headers) and values for <code class="literal">RuleTable</code> definitions. For column headers, you can use either the given labels or any custom labels that begin with the letters listed in the table.
				</p><div class="table" id="idm139794248552848"><p class="title"><strong>Table 17.2. Supported <code class="literal">RuleTable</code> definitions</strong></p><div class="table-contents"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"/><col style="width: 20%; " class="col_2"/><col style="width: 35%; " class="col_3"/><col style="width: 20%; " class="col_4"/></colgroup><thead><tr><th align="left" valign="top" id="idm139794253479696" scope="col">Label</th><th align="left" valign="top" id="idm139794253478640" scope="col">Or custom label that begins with</th><th align="left" valign="top" id="idm139794253477536" scope="col">Value</th><th align="left" valign="top" id="idm139794253476448" scope="col">Usage</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139794253479696">
								<p>
									<code class="literal">NAME</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794253478640">
								<p>
									N
								</p>
								</td><td align="left" valign="top" headers="idm139794253477536">
								<p>
									Provides the name for the rule generated from that row. The default is constructed from the text following the <code class="literal">RuleTable</code> tag and the row number.
								</p>
								</td><td align="left" valign="top" headers="idm139794253476448">
								<p>
									At most one column.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794253479696">
								<p>
									<code class="literal">DESCRIPTION</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794253478640">
								<p>
									I
								</p>
								</td><td align="left" valign="top" headers="idm139794253477536">
								<p>
									Results in a comment within the generated rule.
								</p>
								</td><td align="left" valign="top" headers="idm139794253476448">
								<p>
									At most one column.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794253479696">
								<p>
									<code class="literal">CONDITION</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794253478640">
								<p>
									C
								</p>
								</td><td align="left" valign="top" headers="idm139794253477536">
								<p>
									Code snippet and interpolated values for constructing a constraint within a pattern in a condition.
								</p>
								</td><td align="left" valign="top" headers="idm139794253476448">
								<p>
									At least one per rule table.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794253479696">
								<p>
									<code class="literal">ACTION</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794253478640">
								<p>
									A
								</p>
								</td><td align="left" valign="top" headers="idm139794253477536">
								<p>
									Code snippet and interpolated values for constructing an action for the consequence of the rule.
								</p>
								</td><td align="left" valign="top" headers="idm139794253476448">
								<p>
									At least one per rule table.
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794253479696">
								<p>
									<code class="literal">METADATA</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794253478640">
								<p>
									@
								</p>
								</td><td align="left" valign="top" headers="idm139794253477536">
								<p>
									Code snippet and interpolated values for constructing a metadata entry for the rule.
								</p>
								</td><td align="left" valign="top" headers="idm139794253476448">
								<p>
									Optional, any number of columns.
								</p>
								</td></tr></tbody></table></div></div><p>
					The following sections provide more details about how condition, action, and metadata columns use cell data:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Conditions</span></dt><dd><p class="simpara">
								For columns headed <code class="literal">CONDITION</code>, the cells in consecutive lines result in a conditional element:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
										<span class="strong strong"><strong>First cell:</strong></span> Text in the first cell below <code class="literal">CONDITION</code> develops into a pattern for the rule condition, and uses the snippet in the next line as a constraint. If the cell is merged with one or more neighboring cells, a single pattern with multiple constraints is formed. All constraints are combined into a parenthesized list and appended to the text in this cell.
									</p><p class="simpara">
										If this cell is empty, the code snippet in the cell below it must result in a valid conditional element on its own. For example, instead of <code class="literal">Order</code> as the object type and <code class="literal">itemsCount &gt; $1</code> as a constraint (separate cells), you can leave the object type cell empty and enter <code class="literal">Order( itemsCount &gt; $1 )</code> in the constraint cell, and then do the same for any other constraint cells.
									</p><p class="simpara">
										To include a pattern without constraints, you can write the pattern in front of the text of another pattern, with or without an empty pair of parentheses. You can also append a <code class="literal">from</code> clause to the pattern.
									</p><p class="simpara">
										If the pattern ends with <code class="literal">eval</code>, code snippets produce boolean expressions for inclusion into a pair of parentheses after <code class="literal">eval</code>.
									</p></li><li class="listitem"><p class="simpara">
										<span class="strong strong"><strong>Second cell:</strong></span> Text in the second cell below <code class="literal">CONDITION</code> is processed as a constraint on the object reference in the first cell. The code snippet in this cell is modified by interpolating values from cells farther down in the column. If you want to create a constraint consisting of a comparison using <code class="literal">==</code> with the value from the cells below, then the field selector alone is sufficient. Any other comparison operator must be specified as the last item within the snippet, and the value from the cells below is appended. For all other constraint forms, you must mark the position for including the contents of a cell with the symbol <code class="literal">$param</code>. Multiple insertions are possible if you use the symbols <code class="literal">$1</code>, <code class="literal">$2</code>, and so on, and a comma-separated list of values in the cells below. However, do not separate <code class="literal">$1</code>, <code class="literal">$2</code>, and so on, by commas, or the table will fail to process.
									</p><p class="simpara">
										To expand a text according to the pattern <code class="literal">forall($delimiter){$snippet}</code>, repeat the <code class="literal">$snippet</code> once for each of the values of the comma-separated list in each of the cells below, insert the value in place of the symbol <code class="literal">$</code>, and join these expansions by the given <code class="literal">$delimiter</code>. Note that the <code class="literal">forall</code> construct may be surrounded by other text.
									</p><p class="simpara">
										If the first cell contains an object, the completed code snippet is added to the conditional element from that cell. A pair of parentheses is provided automatically, as well as a separating comma if multiple constraints are added to a pattern in a merged cell. If the first cell is empty, the code snippet in this cell must result in a valid conditional element on its own. For example, instead of <code class="literal">Order</code> as the object type and <code class="literal">itemsCount &gt; $1</code> as a constraint (separate cells), you can leave the object type cell empty and enter <code class="literal">Order( itemsCount &gt; $1 )</code> in the constraint cell, and then do the same for any other constraint cells.
									</p></li><li class="listitem">
										<span class="strong strong"><strong>Third cell:</strong></span> Text in the third cell below <code class="literal">CONDITION</code> is a descriptive label that you define for the column, as a visual aid.
									</li><li class="listitem">
										<span class="strong strong"><strong>Fourth cell:</strong></span> From the fourth row on, non-blank entries provide data for interpolation. A blank cell omits the condition or constraint for this rule.
									</li></ul></div></dd><dt><span class="term">Actions</span></dt><dd><p class="simpara">
								For columns headed <code class="literal">ACTION</code>, the cells in consecutive lines result in an action statement:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>First cell:</strong></span> Text in the first cell below <code class="literal">ACTION</code> is optional. If present, the text is interpreted as an object reference.
									</li><li class="listitem"><p class="simpara">
										<span class="strong strong"><strong>Second cell:</strong></span> Text in the second cell below <code class="literal">ACTION</code> is a code snippet that is modified by interpolating values from cells farther down in the column. For a singular insertion, mark the position for including the contents of a cell with the symbol <code class="literal">$param</code>. Multiple insertions are possible if you use the symbols <code class="literal">$1</code>, <code class="literal">$2</code>, and so on, and a comma-separated list of values in the cells below. However, do not separate <code class="literal">$1</code>, <code class="literal">$2</code>, and so on, by commas, or the table will fail to process.
									</p><p class="simpara">
										A text without any marker symbols can execute a method call without interpolation. In this case, use any non-blank entry in a row below the cell to include the statement. The <code class="literal">forall</code> construct is supported.
									</p><p class="simpara">
										If the first cell contains an object, then the cell text (followed by a period), the text in the second cell, and a terminating semicolon are strung together, resulting in a method call that is added as an action statement for the consequence. If the first cell is empty, the code snippet in this cell must result in a valid action element on its own.
									</p></li><li class="listitem">
										<span class="strong strong"><strong>Third cell:</strong></span> Text in the third cell below <code class="literal">ACTION</code> is a descriptive label that you define for the column, as a visual aid.
									</li><li class="listitem">
										<span class="strong strong"><strong>Fourth cell:</strong></span> From the fourth row on, non-blank entries provide data for interpolation. A blank cell omits the condition or constraint for this rule.
									</li></ul></div></dd><dt><span class="term">Metadata</span></dt><dd><p class="simpara">
								For columns headed <code class="literal">METADATA</code>, the cells in consecutive lines result in a metadata annotation for the generated rules:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>First cell:</strong></span> Text in the first cell below <code class="literal">METADATA</code> is ignored.
									</li><li class="listitem">
										<span class="strong strong"><strong>Second cell:</strong></span> Text in the second cell below <code class="literal">METADATA</code> is subject to interpolation, using values from the cells in the rule rows. The metadata marker character <code class="literal">@</code> is prefixed automatically, so you do not need to include that character in the text for this cell.
									</li><li class="listitem">
										<span class="strong strong"><strong>Third cell:</strong></span> Text in the third cell below <code class="literal">METADATA</code> is a descriptive label that you define for the column, as a visual aid.
									</li><li class="listitem">
										<span class="strong strong"><strong>Fourth cell:</strong></span> From the fourth row on, non-blank entries provide data for interpolation. A blank cell results in the omission of the metadata annotation for this rule.
									</li></ul></div></dd></dl></div></section><section class="section" id="ref-decision-tables-attributes_decision-tables"><div class="titlepage"><div><div><h2 class="title">17.3. Additional rule attributes for RuleSet or RuleTable definitions</h2></div></div></div><p>
					The <code class="literal">RuleSet</code> and <code class="literal">RuleTable</code> areas also support labels and values for other rule attributes, such as <code class="literal">PRIORITY</code> or <code class="literal">NO-LOOP</code>. Rule attributes specified in a <code class="literal">RuleSet</code> area will affect all rule assets in the same package (not only in the spreadsheet). Rule attributes specified in a <code class="literal">RuleTable</code> area will affect only the rules in that rule table. You can use each rule attribute only once in a <code class="literal">RuleSet</code> area and once in a <code class="literal">RuleTable</code> area. If the same attribute is used in both <code class="literal">RuleSet</code> and <code class="literal">RuleTable</code> areas within the spreadsheet, then <code class="literal">RuleTable</code> takes priority and the attribute in the <code class="literal">RuleSet</code> area is overridden.
				</p><p>
					The following table lists the supported labels (column headers) and values for additional <code class="literal">RuleSet</code> or <code class="literal">RuleTable</code> definitions. For column headers, you can use either the given labels or any custom labels that begin with the letters listed in the table.
				</p><div class="table" id="idm139794251954256"><p class="title"><strong>Table 17.3. Additional rule attributes for <code class="literal">RuleSet</code> or <code class="literal">RuleTable</code> definitions</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"/><col style="width: 20%; " class="col_2"/><col style="width: 55%; " class="col_3"/></colgroup><thead><tr><th align="left" valign="top" id="idm139794251947520" scope="col">Label</th><th align="left" valign="top" id="idm139794251946432" scope="col">Or custom label that begins with</th><th align="left" valign="top" id="idm139794251945328" scope="col">Value</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139794251947520">
								<p>
									<code class="literal">PRIORITY</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794251946432">
								<p>
									P
								</p>
								</td><td align="left" valign="top" headers="idm139794251945328">
								<p>
									An integer defining the <code class="literal">salience</code> value of the rule. Rules with a higher salience value are given higher priority when ordered in the activation queue. Overridden by the <code class="literal">Sequential</code> flag.
								</p>
								<p>
									Example: <code class="literal">PRIORITY 10</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794251947520">
								<p>
									<code class="literal">DATE-EFFECTIVE</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794251946432">
								<p>
									V
								</p>
								</td><td align="left" valign="top" headers="idm139794251945328">
								<p>
									A string containing a date and time definition. The rule can be activated only if the current date and time is after a <code class="literal">DATE-EFFECTIVE</code> attribute.
								</p>
								<p>
									Example: <code class="literal">DATE-EFFECTIVE "4-Sep-2018"</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794251947520">
								<p>
									<code class="literal">DATE-EXPIRES</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794251946432">
								<p>
									Z
								</p>
								</td><td align="left" valign="top" headers="idm139794251945328">
								<p>
									A string containing a date and time definition. The rule cannot be activated if the current date and time is after the <code class="literal">DATE-EXPIRES</code> attribute.
								</p>
								<p>
									Example: <code class="literal">DATE-EXPIRES "4-Oct-2018"</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794251947520">
								<p>
									<code class="literal">NO-LOOP</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794251946432">
								<p>
									U
								</p>
								</td><td align="left" valign="top" headers="idm139794251945328">
								<p>
									A Boolean value. When this option is set to <code class="literal">true</code>, the rule cannot be reactivated (looped) if a consequence of the rule re-triggers a previously met condition.
								</p>
								<p>
									Example: <code class="literal">NO-LOOP true</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794251947520">
								<p>
									<code class="literal">ACTIVATION-GROUP</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794251946432">
								<p>
									X
								</p>
								</td><td align="left" valign="top" headers="idm139794251945328">
								<p>
									A string identifying an activation (or XOR) group to which you want to assign the rule. In activation groups, only one rule can be activated. The first rule to fire will cancel all pending activations of all rules in the activation group.
								</p>
								<p>
									Example: <code class="literal">ACTIVATION-GROUP "GroupName"</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794251947520">
								<p>
									<code class="literal">DURATION</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794251946432">
								<p>
									D
								</p>
								</td><td align="left" valign="top" headers="idm139794251945328">
								<p>
									A long integer value defining the duration of time in milliseconds after which the rule can be activated, if the rule conditions are still met.
								</p>
								<p>
									Example: <code class="literal">DURATION 10000</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794251947520">
								<p>
									<code class="literal">TIMER</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794251946432">
								<p>
									T
								</p>
								</td><td align="left" valign="top" headers="idm139794251945328">
								<p>
									A string identifying either <code class="literal">int</code> (interval) or <code class="literal">cron</code> timer definitions for scheduling the rule.
								</p>
								<p>
									Example: <code class="literal">TIMER "*/5 * * * *"</code> (every 5 minutes)
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794251947520">
								<p>
									<code class="literal">CALENDAR</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794251946432">
								<p>
									E
								</p>
								</td><td align="left" valign="top" headers="idm139794251945328">
								<p>
									A Quartz calendar definition for scheduling the rule.
								</p>
								<p>
									Example: <code class="literal">CALENDAR "* * 0-7,18-23 ? * *"</code> (exclude non-business hours)
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794251947520">
								<p>
									<code class="literal">AUTO-FOCUS</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794251946432">
								<p>
									F
								</p>
								</td><td align="left" valign="top" headers="idm139794251945328">
								<p>
									A Boolean value, applicable only to rules within agenda groups. When this option is set to <code class="literal">true</code>, the next time the rule is activated, a focus is automatically given to the agenda group to which the rule is assigned.
								</p>
								<p>
									Example: <code class="literal">AUTO-FOCUS true</code>
								</p>
								</td></tr><tr><td align="left" valign="top" headers="idm139794251947520">
								<p>
									<code class="literal">LOCK-ON-ACTIVE</code>
								</p>
								</td><td align="left" valign="top" headers="idm139794251946432">
								<p>
									L
								</p>
								</td><td align="left" valign="top" headers="idm139794251945328">
								<p>
									A Boolean value, applicable only to rules within rule flow groups or agenda groups. When this option is set to <code class="literal">true</code>, the next time the ruleflow group for the rule becomes active or the agenda group for the rule receives a focus, the rule cannot be activated again until the ruleflow group is no longer active or the agenda group loses the focus. This is a stronger version of the <code class="literal">no-loop</code> attribute, because the activation of a matching rule is discarded regardless of the origin of the update (not only by the rule itself). This attribute is ideal for calculation rules where you have a number of rules that modify a fact and you do not want any rule re-matching and firing again.
								</p>
								<p>
									Example: <code class="literal">LOCK-ON-ACTIVE true</code>
								</p>
								</td></tr></tbody></table></div></div><div class="figure" id="idm139794254186512"><p class="title"><strong>Figure 17.2. Sample decision table spreadsheet with attribute columns</strong></p><div class="figure-contents"><div class="mediaobject"><img src="images/_images/kogito/decision-tables/decision-table-example-03.png" alt="Example decision table with definitions used"/></div></div></div></section></section><section class="chapter" id="con-kogito-service-execution_decision-tables"><div class="titlepage"><div><div><h2 class="title">Chapter 18. Kogito service execution</h2></div></div></div><p>
				After you design your Kogito service, you can build and run your application and then send REST API requests to the application to execute your services. The exact REST API requests that you can use depend on how you set up the application.
			</p><p>
				For example, consider a Kogito service that is set up to generate a <code class="literal">/persons</code> REST API endpoint and determines whether a specified customer is an adult or is underage. In this example, you can send the following <code class="literal">POST</code> request using a REST client or curl utility to add an adult and execute the service:
			</p><div class="formalpara"><p class="title"><strong>Example POST request body to add an adult (JSON)</strong></p><p>
					
<pre class="programlisting language-json">{
  "person": {
    "name": "John Quark",
    "age": 20
  }
}</pre>
				</p></div><div class="formalpara"><p class="title"><strong>Example curl command to add an adult</strong></p><p>
					
<pre class="screen">curl -X POST http://localhost:8080/persons -H 'content-type: application/json' -H 'accept: application/json' -d '{"person": {"name":"John Quark", "age": 20}}'</pre>
				</p></div><div class="formalpara"><p class="title"><strong>Example response (JSON)</strong></p><p>
					
<pre class="programlisting language-json">{
  "id": "3af806dd-8819-4734-a934-728f4c819682",
  "person": {
    "name": "John Quark",
    "age": 20,
    "adult": false
  },
  "isAdult": true
}</pre>
				</p></div><p>
				For information about creating, running, and testing an example application with Kogito services, see
			</p><p>
				For information about deploying your Kogito service to Red Hat OpenShift Container Platform, see
			</p></section></div><div class="part" id="chap-kogito-decision-engine"><div class="titlepage"><div><div><h1 class="title">Part IV. Decision engine in Kogito</h1></div></div></div><div class="partintro" id="idm139794251381424"><div/><p>
				As a developer of business decisions, your understanding of the decision engine in Kogito can help you design more effective business assets and a more scalable decision management architecture. The decision engine is the Kogito component that stores, processes, and evaluates data to execute business rules and to reach the decisions that you define. This document describes basic concepts and functions of the decision engine to consider as you create your business rule system and decision services in Kogito.
			</p><div class="toc"><p><strong>Table of Contents</strong></p><ul class="toc"><li><span class="chapter"><a href="#con-decision-engine_decision-engine">19. Decision engine in Kogito</a></span></li><li><span class="chapter"><a href="#con-execution-control_decision-engine">20. Execution control in the decision engine</a></span><ul><li><span class="section"><a href="#salience_for_rules">20.1. Salience for rules</a></span></li><li><span class="section"><a href="#activation_groups_for_rules">20.2. Activation groups for rules</a></span></li></ul></li><li><span class="chapter"><a href="#con-phreak-rule-evaluation_decision-engine">21. Rule evaluation in Phreak</a></span><ul><li><span class="section"><a href="#con-forward-and-backward-chaining_decision-engine">21.1. Rule evaluation with forward and backward chaining</a></span></li></ul></li><li><span class="chapter"><a href="#con-property-change-listeners_decision-engine">22. Property-change settings and listeners for fact types</a></span></li><li><span class="chapter"><a href="#con-engine-event-listeners_decision-engine">23. Decision engine event listeners and debug logging</a></span></li></ul></div></div><section class="chapter" id="con-decision-engine_decision-engine"><div class="titlepage"><div><div><h2 class="title">Chapter 19. Decision engine in Kogito</h2></div></div></div><p>
				The decision engine is the rules engine in Kogito. The decision engine stores, processes, and evaluates data to execute the business rules or decision models that you define. The basic function of the decision engine is to match incoming data, or <span class="emphasis"><em>facts</em></span>, to the conditions of rules and determine whether and how to execute the rules.
			</p><p>
				The decision engine operates using the following basic components:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<span class="strong strong"><strong>Rules:</strong></span> Business rules or DMN decisions that you define. All rules must contain at a minimum the conditions that trigger the rule and the actions that the rule dictates.
					</li><li class="listitem">
						<span class="strong strong"><strong>Facts:</strong></span> Data that enters or changes in the decision engine that the decision engine matches to rule conditions to execute applicable rules.
					</li><li class="listitem">
						<span class="strong strong"><strong>Production memory:</strong></span> Location where rules are stored in the decision engine.
					</li><li class="listitem">
						<span class="strong strong"><strong>Working memory:</strong></span> Location where facts are stored in the decision engine.
					</li><li class="listitem">
						<span class="strong strong"><strong>Agenda:</strong></span> Location where activated rules are registered and sorted (if applicable) in preparation for execution.
					</li></ul></div><p>
				When a business user or an automated system adds or updates rule-related information in Kogito, that information is inserted into the working memory of the decision engine in the form of one or more facts. The decision engine matches those facts to the conditions of the rules that are stored in the production memory to determine eligible rule executions. (This process of matching facts to rules is often referred to as <span class="emphasis"><em>pattern matching</em></span>.) When rule conditions are met, the decision engine activates and registers rules in the agenda, where the decision engine then sorts prioritized or conflicting rules in preparation for execution.
			</p><p>
				The following diagram illustrates these basic components of the decision engine:
			</p><div class="figure" id="idm139794251365264"><p class="title"><strong>Figure 19.1. Overview of basic decision engine components</strong></p><div class="figure-contents"><div style="text-align: center; " class="mediaobject"><img style="text-align: middle" src="images/_images/kogito/decision-engine/rule-engine-inkscape_enterprise.png" alt="rule engine inkscape enterprise"/></div></div></div><p>
				These core concepts can help you to better understand other more advanced components, processes, and subprocesses of the decision engine, and as a result, to design more effective business assets in Kogito.
			</p></section><section class="chapter" id="con-execution-control_decision-engine"><div class="titlepage"><div><div><h2 class="title">Chapter 20. Execution control in the decision engine</h2></div></div></div><p>
				When new rule data enters the working memory of the decision engine, rules may become fully matched and eligible for execution. A single working memory action can result in multiple eligible rule executions. When a rule is fully matched, the decision engine creates an activation instance, referencing the rule and the matched facts, and adds the activation onto the decision engine agenda. The agenda controls the execution order of these rule activations using a conflict resolution strategy.
			</p><p>
				When rules are executed, the decision engine cycles repeatedly through two phases:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<span class="strong strong"><strong>Agenda evaluation.</strong></span> In this phase, the decision engine selects all rules that can be executed. If no executable rules exist, the execution cycle ends. If an executable rule is found, the decision engine registers the activation in the agenda and then moves on to the working memory actions phase to perform rule consequence actions.
					</li><li class="listitem">
						<span class="strong strong"><strong>Working memory actions.</strong></span> In this phase, the decision engine performs the rule consequence actions (the <code class="literal">then</code> portion of each rule) for all activated rules previously registered in the agenda. After all the consequence actions are complete or the rules are executed again, the decision engine returns to the agenda evaluation phase to reassess rules.
					</li></ul></div><div class="figure" id="idm139794254158688"><p class="title"><strong>Figure 20.1. Two-phase execution process in the decision engine</strong></p><div class="figure-contents"><div style="text-align: center; " class="mediaobject"><img style="text-align: middle" src="images/_images/kogito/decision-engine/Two_Phase_enterprise.png" alt="Two Phase enterprise"/></div></div></div><p>
				When multiple rules exist on the agenda, the execution of one rule may cause another rule to be removed from the agenda. To avoid this, you can define how and when rules are executed in the decision engine. Some common methods for defining rule execution order are by using rule salience, agenda groups, activation groups, or rule units for DRL rule sets.
			</p><section class="section" id="salience_for_rules"><div class="titlepage"><div><div><h2 class="title">20.1. Salience for rules</h2></div></div></div><p>
					Each rule has an integer <code class="literal">salience</code> attribute that determines the order of execution. Rules with a higher salience value are given higher priority when ordered in the activation queue. The default salience value for rules is zero, but the salience can be negative or positive.
				</p><p>
					For example, the following sample DRL rules are listed in the decision engine stack in the order shown:
				</p><pre class="screen">rule "RuleA"
salience 95
  when
    $fact : /myFact[ field1 == true ]
  then
    System.out.println("Rule2 : " + $fact);
    update($fact);
end

rule "RuleB"
salience 100
  when
    $fact : /myFact[ field1 == false ]
  then
    System.out.println("Rule1 : " + $fact);
    $fact.setField1(true);
    update($fact);
end</pre><p>
					The <code class="literal">RuleB</code> rule is listed second, but it has a higher salience value than the <code class="literal">RuleA</code> rule and is therefore executed first.
				</p></section><section class="section" id="activation_groups_for_rules"><div class="titlepage"><div><div><h2 class="title">20.2. Activation groups for rules</h2></div></div></div><p>
					An activation group is a set of rules bound together by the same <code class="literal">activation-group</code> rule attribute. In this group, only one rule can be executed. After conditions are met for a rule in that group to be executed, all other pending rule executions from that activation group are removed from the agenda.
				</p><p>
					For example, the following sample DRL rules belong to the specified activation group and are listed in the decision engine stack in the order shown:
				</p><div class="formalpara"><p class="title"><strong>Sample DRL rules for banking</strong></p><p>
						
<pre class="screen">rule "Print balance for AccountPeriod1"
activation-group "report"
  when
    ap : AccountPeriod1()
    acc : Account()
  then
    System.out.println( acc.accountNo +
                      " : " + acc.balance );
end</pre>
					</p></div><pre class="screen">rule "Print balance for AccountPeriod2"
activation-group "report"
  when
    ap : AccountPeriod2()
    acc : Account()
  then
    System.out.println( acc.accountNo +
                      " : " + acc.balance );
end</pre><p>
					For this example, if the first rule in the <code class="literal">"report"</code> activation group is executed, the second rule in the group and all other executable rules on the agenda are removed from the agenda.
				</p></section></section><section class="chapter" id="con-phreak-rule-evaluation_decision-engine"><div class="titlepage"><div><div><h2 class="title">Chapter 21. Rule evaluation in Phreak</h2></div></div></div><p>
				When the decision engine starts, all rules are considered to be <span class="emphasis"><em>unlinked</em></span> from pattern-matching data that can trigger the rules. At this stage, the Phreak algorithm in the decision engine does not evaluate the rules. The rule actions are queued, and Phreak uses a heuristic, based on the rule most likely to result in execution, to calculate and select the next rule for evaluation. When all the required input values are populated for a rule, the rule is considered to be <span class="emphasis"><em>linked</em></span> to the relevant pattern-matching data. Phreak then creates a goal that represents this rule and places the goal into a priority queue that is ordered by rule salience. Only the rule for which the goal was created is evaluated, and other potential rule evaluations are delayed. While individual rules are evaluated, node sharing is still achieved through the process of segmentation.
			</p><p>
				Unlike the tuple-oriented Rete, the Phreak propagation is collection oriented. For the rule that is being evaluated, the decision engine accesses the first node and processes all queued insert, update, and delete actions. The results are added to a set, and the set is propagated to the child node. In the child node, all queued insert, update, and delete actions are processed, adding the results to the same set. The set is then propagated to the next child node and the same process repeats until it reaches the terminal node. This cycle creates a batch process effect that can provide performance advantages for certain rule constructs.
			</p><p>
				The linking and unlinking of rules happens through a layered bit-mask system, based on network segmentation. When the rule network is built, segments are created for rule network nodes that are shared by the same set of rules. A rule is composed of a path of segments. In case a rule does not share any node with any other rule, it becomes a single segment.
			</p><p>
				A bit-mask offset is assigned to each node in the segment. Another bit mask is assigned to each segment in the path of the rule according to these requirements:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						If at least one input for a node exists, the node bit is set to the <code class="literal">on</code> state.
					</li><li class="listitem">
						If each node in a segment has the bit set to the <code class="literal">on</code> state, the segment bit is also set to the <code class="literal">on</code> state.
					</li><li class="listitem">
						If any node bit is set to the <code class="literal">off</code> state, the segment is also set to the <code class="literal">off</code> state.
					</li><li class="listitem">
						If each segment in the path of the rule is set to the <code class="literal">on</code> state, the rule is considered linked, and a goal is created to schedule the rule for evaluation.
					</li></ul></div><p>
				The same bit-mask technique is used to track modified nodes, segments, and rules. This tracking ability enables an already linked rule to be unscheduled from evaluation if it has been modified since the evaluation goal for it was created. As a result, no rules can ever evaluate partial matches.
			</p><p>
				This process of rule evaluation is possible in Phreak because, as opposed to a single unit of memory in Rete, Phreak has three layers of contextual memory with node, segment, and rule memory types. This layering enables much more contextual understanding during the evaluation of a rule.
			</p><div class="figure" id="idm139794249828144"><p class="title"><strong>Figure 21.1. Phreak three-layered memory system</strong></p><div class="figure-contents"><div style="text-align: center; " class="mediaobject"><img style="text-align: middle" src="images/_images/kogito/decision-engine/LayeredMemory_enterprise.png" alt="LayeredMemory enterprise"/></div></div></div><p>
				The following examples illustrate how rules are organized and evaluated in this three-layered memory system in Phreak.
			</p><p>
				<span class="strong strong"><strong>Example 1:</strong></span> A single rule (R1) with three patterns: A, B and C. The rule forms a single segment, with bits 1, 2, and 4 for the nodes. The single segment has a bit offset of 1.
			</p><div class="figure" id="idm139794253763424"><p class="title"><strong>Figure 21.2. Example 1: Single rule</strong></p><div class="figure-contents"><div style="text-align: center; " class="mediaobject"><img style="text-align: middle" src="images/_images/kogito/decision-engine/segment1_enterprise.png" alt="segment1 enterprise"/></div></div></div><p>
				<span class="strong strong"><strong>Example 2:</strong></span> Rule R2 is added and shares pattern A.
			</p><div class="figure" id="idm139794253758112"><p class="title"><strong>Figure 21.3. Example 2: Two rules with pattern sharing</strong></p><div class="figure-contents"><div style="text-align: center; " class="mediaobject"><img style="text-align: middle" src="images/_images/kogito/decision-engine/segment2_enterprise.png" alt="segment2 enterprise"/></div></div></div><p>
				Pattern A is placed in its own segment, resulting in two segments for each rule. Those two segments form a path for their respective rules. The first segment is shared by both paths. When pattern A is linked, the segment becomes linked. The segment then iterates over each path that the segment is shared by, setting the bit 1 to <code class="literal">on</code>. If patterns B and C are later turned on, the second segment for path R1 is linked, and this causes bit 2 to be turned on for R1. With bit 1 and bit 2 turned on for R1, the rule is now linked and a goal is created to schedule the rule for later evaluation and execution.
			</p><p>
				When a rule is evaluated, the segments enable the results of the matching to be shared. Each segment has a staging memory to queue all inserts, updates, and deletes for that segment. When R1 is evaluated, the rule processes pattern A, and this results in a set of tuples. The algorithm detects a segmentation split, creates peered tuples for each insert, update, and delete in the set, and adds them to the R2 staging memory. Those tuples are then merged with any existing staged tuples and are executed when R2 is eventually evaluated.
			</p><p>
				<span class="strong strong"><strong>Example 3:</strong></span> Rules R3 and R4 are added and share patterns A and B.
			</p><div class="figure" id="idm139794253750288"><p class="title"><strong>Figure 21.4. Example 3: Three rules with pattern sharing</strong></p><div class="figure-contents"><div style="text-align: center; " class="mediaobject"><img style="text-align: middle" src="images/_images/kogito/decision-engine/segment3_enterprise.png" alt="segment3 enterprise"/></div></div></div><p>
				Rules R3 and R4 have three segments and R1 has two segments. Patterns A and B are shared by R1, R3, and R4, while pattern D is shared by R3 and R4.
			</p><p>
				<span class="strong strong"><strong>Example 4:</strong></span> A single rule (R1) with a subnetwork and no pattern sharing.
			</p><div class="figure" id="idm139794252961552"><p class="title"><strong>Figure 21.5. Example 4: Single rule with a subnetwork and no pattern sharing</strong></p><div class="figure-contents"><div style="text-align: center; " class="mediaobject"><img style="text-align: middle" src="images/_images/kogito/decision-engine/segment4_enterprise.png" alt="segment4 enterprise"/></div></div></div><p>
				Subnetworks are formed when a <code class="literal">Not</code>, <code class="literal">Exists</code>, or <code class="literal">Accumulate</code> node contains more than one element. In this example, the element <code class="literal">B not( C )</code> forms the subnetwork. The element <code class="literal">not( C )</code> is a single element that does not require a subnetwork and is therefore merged inside of the <code class="literal">Not</code> node. The subnetwork uses a dedicated segment. Rule R1 still has a path of two segments and the subnetwork forms another inner path. When the subnetwork is linked, it is also linked in the outer segment.
			</p><p>
				<span class="strong strong"><strong>Example 5:</strong></span> Rule R1 with a subnetwork that is shared by rule R2.
			</p><div class="figure" id="idm139794252952688"><p class="title"><strong>Figure 21.6. Example 5: Two rules, one with a subnetwork and pattern sharing</strong></p><div class="figure-contents"><div style="text-align: center; " class="mediaobject"><img style="text-align: middle" src="images/_images/kogito/decision-engine/segment5_enterprise.png" alt="segment5 enterprise"/></div></div></div><p>
				The subnetwork nodes in a rule can be shared by another rule that does not have a subnetwork. This sharing causes the subnetwork segment to be split into two segments.
			</p><p>
				Constrained <code class="literal">Not</code> nodes and <code class="literal">Accumulate</code> nodes can never unlink a segment, and are always considered to have their bits turned on.
			</p><p>
				The Phreak evaluation algorithm is stack based instead of method-recursion based. Rule evaluation can be paused and resumed at any time when a <code class="literal">StackEntry</code> is used to represent the node currently being evaluated.
			</p><p>
				When a rule evaluation reaches a subnetwork, a <code class="literal">StackEntry</code> object is created for the outer path segment and the subnetwork segment. The subnetwork segment is evaluated first, and when the set reaches the end of the subnetwork path, the segment is merged into a staging list for the outer node that the segment feeds into. The previous <code class="literal">StackEntry</code> object is then resumed and can now process the results of the subnetwork. This process has the added benefit, especially for <code class="literal">Accumulate</code> nodes, that all work is completed in a batch, before propagating to the child node.
			</p><p>
				The same stack system is used for efficient backward chaining. When a rule evaluation reaches a query node, the evaluation is paused and the query is added to the stack. The query is then evaluated to produce a result set, which is saved in a memory location for the resumed <code class="literal">StackEntry</code> object to pick up and propagate to the child node. If the query itself called other queries, the process repeats, while the current query is paused and a new evaluation is set up for the current query node.
			</p><section class="section" id="con-forward-and-backward-chaining_decision-engine"><div class="titlepage"><div><div><h2 class="title">21.1. Rule evaluation with forward and backward chaining</h2></div></div></div><p>
					The decision engine in Kogito is a hybrid reasoning system that uses both forward chaining and backward chaining to evaluate rules. A forward-chaining rule system is a data-driven system that starts with a fact in the working memory of the decision engine and reacts to changes to that fact. When objects are inserted into working memory, any rule conditions that become true as a result of the change are scheduled for execution by the agenda.
				</p><p>
					In contrast, a backward-chaining rule system is a goal-driven system that starts with a conclusion that the decision engine attempts to satisfy, often using recursion. If the system cannot reach the conclusion or goal, it searches for subgoals, which are conclusions that complete part of the current goal. The system continues this process until either the initial conclusion is satisfied or all subgoals are satisfied.
				</p><p>
					The following diagram illustrates how the decision engine evaluates rules using forward chaining overall with a backward-chaining segment in the logic flow:
				</p><div class="figure" id="idm139794249490128"><p class="title"><strong>Figure 21.7. Rule evaluation logic using forward and backward chaining</strong></p><div class="figure-contents"><div style="text-align: center; " class="mediaobject"><img style="text-align: middle" src="images/_images/kogito/decision-engine/RuleEvaluation_Enterprise.png" alt="RuleEvaluation Enterprise"/></div></div></div></section></section><section class="chapter" id="con-property-change-listeners_decision-engine"><div class="titlepage"><div><div><h2 class="title">Chapter 22. Property-change settings and listeners for fact types</h2></div></div></div><p>
				By default, the decision engine does not re-evaluate all fact patterns for fact types each time a rule is triggered, but instead reacts only to modified properties that are constrained or bound inside a given pattern. For example, if a rule calls <code class="literal">modify()</code> on a fact as part of the rule actions, this modification does not automatically trigger the re-evaluation of all patterns referring to the modified type. Only the patterns constrained on the changed properties of that fact are re-evaluated. This property reactivity behavior prevents unwanted recursions and results in more efficient rule evaluation. This behavior also avoids the need of using the <code class="literal">no-loop</code> rule attribute to prevent infinite recursion.
			</p><p>
				You can modify or disable this property reactivity behavior with the following options, and then use a property-change setting in your Java class or DRL files to fine-tune property reactivity as needed:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">ALWAYS</code>: (Default) All types are property reactive, but you can disable property reactivity for a specific type by using the <code class="literal">@classReactive</code> property-change setting.
					</li><li class="listitem">
						<code class="literal">ALLOWED</code>: No types are property reactive, but you can enable property reactivity for a specific type by using the <code class="literal">@propertyReactive</code> property-change setting.
					</li><li class="listitem">
						<code class="literal">DISABLED</code>: No types are property reactive. All property-change listeners are ignored.
					</li></ul></div><p>
				To set the property reactivity behavior, update the <code class="literal">drools.propertySpecific</code> system property in the <code class="literal">application.properties</code> file of your Kogito project:
			</p><div class="formalpara"><p class="title"><strong>Example property reactivity setting in system properties</strong></p><p>
					
<pre class="screen">drools.propertySpecific=ALLOWED</pre>
				</p></div><p>
				The decision engine supports the following property-change settings and listeners for fact classes or declared DRL fact types:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">@classReactive</span></dt><dd><p class="simpara">
							If property reactivity is set to <code class="literal">ALWAYS</code> in the decision engine (all types are property reactive), this tag disables the default property reactivity behavior for a specific Java class or a declared DRL fact type. You can use this tag if you want the decision engine to re-evaluate all fact patterns for the specified fact type each time the rule is triggered, instead of reacting only to modified properties that are constrained or bound inside a given pattern.
						</p><div class="formalpara"><p class="title"><strong>Example: Disable default property reactivity in a DRL type declaration</strong></p><p>
								
<pre class="screen">declare Person
  @classReactive
    firstName : String
    lastName : String
end</pre>
							</p></div><div class="formalpara"><p class="title"><strong>Example: Disable default property reactivity in a Java class</strong></p><p>
								
<pre class="programlisting language-java">@classReactive
public static class Person {
    private String firstName;
    private String lastName;
}</pre>
							</p></div></dd><dt><span class="term">@propertyReactive</span></dt><dd><p class="simpara">
							If property reactivity is set to <code class="literal">ALLOWED</code> in the decision engine (no types are property reactive unless specified), this tag enables property reactivity for a specific Java class or a declared DRL fact type. You can use this tag if you want the decision engine to react only to modified properties that are constrained or bound inside a given pattern for the specified fact type, instead of re-evaluating all fact patterns for the fact each time the rule is triggered.
						</p><div class="formalpara"><p class="title"><strong>Example: Enable property reactivity in a DRL type declaration (when reactivity is disabled globally)</strong></p><p>
								
<pre class="screen">declare Person
  @propertyReactive
    firstName : String
    lastName : String
end</pre>
							</p></div><div class="formalpara"><p class="title"><strong>Example: Enable property reactivity in a Java class (when reactivity is disabled globally)</strong></p><p>
								
<pre class="programlisting language-java">@propertyReactive
public static class Person {
    private String firstName;
    private String lastName;
}</pre>
							</p></div></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">@propertyChangeSupport</span></dt><dd><p class="simpara">
							For facts that implement support for property changes as defined in the <a class="link" href="https://download.oracle.com/otndocs/jcp/7224-javabeans-1.01-fr-spec-oth-JSpec/">JavaBeans Specification</a>, this tag enables the decision engine to monitor changes in the fact properties.
						</p><div class="formalpara"><p class="title"><strong>Example: Declare property change support in JavaBeans object</strong></p><p>
								
<pre class="screen">declare Person
    @propertyChangeSupport
end</pre>
							</p></div></dd></dl></div></section><section class="chapter" id="con-engine-event-listeners_decision-engine"><div class="titlepage"><div><div><h2 class="title">Chapter 23. Decision engine event listeners and debug logging</h2></div></div></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					The APIs for decision engine event listeners in Kogito are subject to change.
				</p></div></div><p>
				In Kogito, you can add or remove listeners for decision engine events, such as fact insertions and rule executions. With decision engine event listeners, you can be notified of decision engine activity and separate your logging and auditing work from the core of your application.
			</p><p>
				The decision engine supports the following default event listeners for the agenda and working memory:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">AgendaEventListener</code>
					</li><li class="listitem">
						<code class="literal">WorkingMemoryEventListener</code>
					</li></ul></div><p>
				For each event listener, the decision engine also supports the following specific events that you can specify to be monitored:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">MatchCreatedEvent</code>
					</li><li class="listitem">
						<code class="literal">MatchCancelledEvent</code>
					</li><li class="listitem">
						<code class="literal">BeforeMatchFiredEvent</code>
					</li><li class="listitem">
						<code class="literal">AfterMatchFiredEvent</code>
					</li><li class="listitem">
						<code class="literal">AgendaGroupPushedEvent</code>
					</li><li class="listitem">
						<code class="literal">AgendaGroupPoppedEvent</code>
					</li><li class="listitem">
						<code class="literal">ObjectInsertEvent</code>
					</li><li class="listitem">
						<code class="literal">ObjectDeletedEvent</code>
					</li><li class="listitem">
						<code class="literal">ObjectUpdatedEvent</code>
					</li><li class="listitem">
						<code class="literal">ProcessCompletedEvent</code>
					</li><li class="listitem">
						<code class="literal">ProcessNodeLeftEvent</code>
					</li><li class="listitem">
						<code class="literal">ProcessNodeTriggeredEvent</code>
					</li><li class="listitem">
						<code class="literal">ProcessStartEvent</code>
					</li></ul></div><p>
				For example, the following code uses a <code class="literal">DefaultAgendaEventListener</code> listener and specifies the <code class="literal">AfterMatchFiredEvent</code> event to be monitored. The code prints pattern matches after the rules are executed (fired):
			</p><div class="formalpara"><p class="title"><strong>Example code to monitor and print <code class="literal">AfterMatchFiredEvent</code> events in the agenda</strong></p><p>
					
<pre class="programlisting language-java">public class MyListener extends DefaultAgendaEventListener {
    public void afterMatchFired(AfterMatchFiredEvent event) {
        super.afterMatchFired( event );
        System.out.println( event );
    }
}

@ApplicationScoped
public class RuleEventListenerConfig extends DefaultRuleEventListenerConfig {
    public RuleEventListenerConfig() {
        super(new MyListener());
    }
}</pre>
				</p></div><p>
				The decision engine also supports the following agenda and working memory event listeners for debug logging:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">DebugAgendaEventListener</code>
					</li><li class="listitem">
						<code class="literal">DebugRuleRuntimeEventListener</code>
					</li></ul></div><p>
				These event listeners implement the same supported event-listener methods and include a debug print statement by default. You can add a specific supported event to be monitored and documented, or monitor all agenda or working memory activity.
			</p><p>
				For example, the following code uses the <code class="literal">DebugRuleRuntimeEventListener</code> event listener to monitor and print all working memory events:
			</p><div class="formalpara"><p class="title"><strong>Example code to monitor and print all working memory events</strong></p><p>
					
<pre class="programlisting language-java">@ApplicationScoped
public class RuleEventListenerConfig extends DefaultRuleEventListenerConfig {
    public RuleEventListenerConfig() {
        super(new DebugRuleRuntimeEventListener());
    }
}</pre>
				</p></div></section></div><section class="appendix" id="versioning-information"><div class="titlepage"><div><div><h1 class="title">Appendix A. Versioning information</h1></div></div></div><p>
			Documentation last updated on Tuesday, April 21, 2020.
		</p></section><div><div xml:lang="en-US" class="legalnotice" id="idm139794259275536"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"/>© 2020 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri" href="http://creativecommons.org/licenses/by-sa/3.0/">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div></div></div><script type="text/javascript">
                        jQuery(document).ready(function() {
                            initSwitchery();
                            jQuery('pre[class*="language-"]').each(function(i, block){hljs.highlightBlock(block);});
                        });
                    </script></body></html>